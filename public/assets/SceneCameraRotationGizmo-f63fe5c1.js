import{a7 as N,_ as Z,a8 as Q,L as y,N as e,W as V,a9 as F,aa as X,ab as Y,ac as J,$ as k,a0 as x,ad as K,ae as $,af as ee,ag as b,ah as te,ai as G,aj as ne,Z as D,ak as re,al as oe,a4 as ae,j as E,R as L}from"./index-bbd1ebcb.js";import{C as ie,E as se,O as ce}from"./Environment-bbcc9cfa.js";function le(t){return function(r){t.forEach(function(a){typeof a=="function"?a(r):a!=null&&(a.current=r)})}}function ue(t,r,a,o){const s=class extends Z{constructor(u={}){const i=Object.entries(t);super({uniforms:i.reduce((c,[d,p])=>{const f=Q.clone({[d]:{value:p}});return{...c,...f}},{}),vertexShader:r,fragmentShader:a}),this.key="",i.forEach(([c])=>Object.defineProperty(this,c,{get:()=>this.uniforms[c].value,set:d=>this.uniforms[c].value=d})),Object.assign(this,u),o&&o(this)}};return s.key=N.generateUUID(),s}function fe(t,r,a){const o=y(m=>m.size),s=y(m=>m.viewport),g=typeof t=="number"?t:o.width*s.dpr,u=typeof r=="number"?r:o.height*s.dpr,i=(typeof t=="number"?a:t)||{},{samples:c=0,depth:d,...p}=i,f=e.useMemo(()=>{const m=new V(g,u,{minFilter:F,magFilter:F,type:X,...p});return d&&(m.depthTexture=new Y(g,u,J)),m.samples=c,m},[]);return e.useLayoutEffect(()=>{f.setSize(g,u),c&&(f.samples=c)},[c,f,g,u]),e.useEffect(()=>()=>f.dispose(),[]),f}const me=t=>typeof t=="function",de=e.forwardRef(({envMap:t,resolution:r=256,frames:a=1/0,children:o,makeDefault:s,...g},u)=>{const i=y(({set:n})=>n),c=y(({camera:n})=>n),d=y(({size:n})=>n),p=e.useRef(null),f=e.useRef(null),m=fe(r);e.useLayoutEffect(()=>{g.manual||p.current.updateProjectionMatrix()},[d,g]),e.useLayoutEffect(()=>{p.current.updateProjectionMatrix()}),e.useLayoutEffect(()=>{if(s){const n=c;return i(()=>({camera:p.current})),()=>i(()=>({camera:n}))}},[p,s,i]);let h=0,v=null;const l=me(o);return k(n=>{l&&(a===1/0||h<a)&&(f.current.visible=!1,n.gl.setRenderTarget(m),v=n.scene.background,t&&(n.scene.background=t),n.gl.render(n.scene,p.current),n.scene.background=v,n.gl.setRenderTarget(null),f.current.visible=!0,h++)}),e.createElement(e.Fragment,null,e.createElement("orthographicCamera",x({left:d.width/-2,right:d.width/2,top:d.height/2,bottom:d.height/-2,ref:le([p,u])},g),!l&&o),e.createElement("group",{ref:f},l&&o(m.texture)))});function ge({defaultScene:t,defaultCamera:r,renderPriority:a=1}){const{gl:o,scene:s,camera:g}=y();let u;return k(()=>{u=o.autoClear,a===1&&(o.autoClear=!0,o.render(t,r)),o.autoClear=!1,o.clearDepth(),o.render(s,g),o.autoClear=u},a),e.createElement("group",{onPointerOver:()=>null})}function pe({children:t,renderPriority:r=1}){const{scene:a,camera:o}=y(),[s]=e.useState(()=>new K);return e.createElement(e.Fragment,null,$(e.createElement(e.Fragment,null,t,e.createElement(ge,{defaultScene:a,defaultCamera:o,renderPriority:r})),s,{events:{priority:r+1}}))}const U=e.createContext({}),he=()=>e.useContext(U),ye=2*Math.PI,S=new ee,O=new te,[w,z]=[new G,new G],_=new b,A=new b,ve=t=>"minPolarAngle"in t,xe=({alignment:t="bottom-right",margin:r=[80,80],renderPriority:a=1,onUpdate:o,onTarget:s,children:g})=>{const u=y(C=>C.size),i=y(C=>C.camera),c=y(C=>C.controls),d=y(C=>C.invalidate),p=e.useRef(),f=e.useRef(null),m=e.useRef(!1),h=e.useRef(0),v=e.useRef(new b(0,0,0)),l=e.useRef(new b(0,0,0));e.useEffect(()=>{l.current.copy(i.up)},[i]);const n=e.useCallback(C=>{m.current=!0,(c||s)&&(v.current=(c==null?void 0:c.target)||(s==null?void 0:s())),h.current=i.position.distanceTo(_),w.copy(i.quaternion),A.copy(C).multiplyScalar(h.current).add(_),S.lookAt(A),S.up.copy(i.up),z.copy(S.quaternion),d()},[c,i,s,d]);k((C,q)=>{if(f.current&&p.current){var T;if(m.current)if(w.angleTo(z)<.01)m.current=!1,ve(c)&&i.up.copy(l.current);else{const B=q*ye;w.rotateTowards(z,B),i.position.set(0,0,1).applyQuaternion(w).multiplyScalar(h.current).add(v.current),i.up.set(0,1,0).applyQuaternion(w).normalize(),i.quaternion.copy(w),o?o():c&&c.update(),d()}O.copy(i.matrix).invert(),(T=p.current)==null||T.quaternion.setFromRotationMatrix(O)}});const I=e.useMemo(()=>({tweenCamera:n}),[n]),[R,j]=r,W=t.endsWith("-center")?0:t.endsWith("-left")?-u.width/2+R:u.width/2-R,H=t.startsWith("center-")?0:t.startsWith("top-")?u.height/2-j:-u.height/2+j;return e.createElement(pe,{renderPriority:a},e.createElement(U.Provider,{value:I},e.createElement(de,{makeDefault:!0,ref:f,position:[0,0,200]}),e.createElement("group",{ref:p,position:[W,H,0]},g)))};function M({scale:t=[.8,.05,.05],color:r,rotation:a}){return e.createElement("group",{rotation:a},e.createElement("mesh",{position:[.4,0,0]},e.createElement("boxGeometry",{args:t}),e.createElement("meshBasicMaterial",{color:r,toneMapped:!1})))}function P({onClick:t,font:r,disabled:a,arcStyle:o,label:s,labelColor:g,axisHeadScale:u=1,...i}){const c=y(l=>l.gl),d=e.useMemo(()=>{const l=document.createElement("canvas");l.width=64,l.height=64;const n=l.getContext("2d");return n.beginPath(),n.arc(32,32,16,0,2*Math.PI),n.closePath(),n.fillStyle=o,n.fill(),s&&(n.font=r,n.textAlign="center",n.fillStyle=g,n.fillText(s,32,41)),new ne(l)},[o,s,g,r]),[p,f]=e.useState(!1),m=(s?1:.75)*(p?1.2:1)*u,h=l=>{l.stopPropagation(),f(!0)},v=l=>{l.stopPropagation(),f(!1)};return e.createElement("sprite",x({scale:m,onPointerOver:a?void 0:h,onPointerOut:a?void 0:t||v},i),e.createElement("spriteMaterial",{map:d,"map-anisotropy":c.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:s?1:.75,toneMapped:!1}))}const Ce=({hideNegativeAxes:t,hideAxisHeads:r,disabled:a,font:o="18px Inter var, Arial, sans-serif",axisColors:s=["#ff2060","#20df80","#2080ff"],axisHeadScale:g=1,axisScale:u,labels:i=["X","Y","Z"],labelColor:c="#000",onClick:d,...p})=>{const[f,m,h]=s,{tweenCamera:v}=he(),l={font:o,disabled:a,labelColor:c,onClick:d,axisHeadScale:g,onPointerDown:a?void 0:n=>{v(n.object.position),n.stopPropagation()}};return e.createElement("group",x({scale:40},p),e.createElement(M,{color:f,rotation:[0,0,0],scale:u}),e.createElement(M,{color:m,rotation:[0,0,Math.PI/2],scale:u}),e.createElement(M,{color:h,rotation:[0,-Math.PI/2,0],scale:u}),!r&&e.createElement(e.Fragment,null,e.createElement(P,x({arcStyle:f,position:[1,0,0],label:i[0]},l)),e.createElement(P,x({arcStyle:m,position:[0,1,0],label:i[1]},l)),e.createElement(P,x({arcStyle:h,position:[0,0,1],label:i[2]},l)),!t&&e.createElement(e.Fragment,null,e.createElement(P,x({arcStyle:f,position:[-1,0,0]},l)),e.createElement(P,x({arcStyle:m,position:[0,-1,0]},l)),e.createElement(P,x({arcStyle:h,position:[0,0,-1]},l)))),e.createElement("ambientLight",{intensity:.5}),e.createElement("pointLight",{position:[10,10,10],intensity:.5}))},Ee=ue({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,cellThickness:.5,sectionThickness:1,cellColor:new D,sectionColor:new D,infiniteGrid:!1,followCamera:!1},`
    varying vec3 worldPosition;
    uniform float fadeDistance;
    uniform bool infiniteGrid;
    uniform bool followCamera;

    void main() {
      worldPosition = position.xzy;
      if (infiniteGrid) worldPosition *= 1.0 + fadeDistance;
      if (followCamera) worldPosition.xz +=cameraPosition.xz;

      gl_Position = projectionMatrix * modelViewMatrix * vec4(worldPosition, 1.0);
    }
  `,`
    varying vec3 worldPosition;
    uniform float cellSize;
    uniform float sectionSize;
    uniform vec3 cellColor;
    uniform vec3 sectionColor;
    uniform float fadeDistance;
    uniform float fadeStrength;
    uniform float cellThickness;
    uniform float sectionThickness;

    float getGrid(float size, float thickness) {
      vec2 r = worldPosition.xz / size;
      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
      float line = min(grid.x, grid.y) + 1. - thickness;
      return 1.0 - min(line, 1.);
    }

    void main() {
      float g1 = getGrid(cellSize, cellThickness);
      float g2 = getGrid(sectionSize, sectionThickness);

      float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / fadeDistance, 1.);
      vec3 color = mix(cellColor, sectionColor, min(1.,sectionThickness * g2));

      gl_FragColor = vec4(color, (g1 + g2) * pow(d,fadeStrength));
      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);
      if (gl_FragColor.a <= 0.0) discard;

      #include <tonemapping_fragment>
      #include <encodings_fragment>
    }
  `),we=e.forwardRef(({args:t,cellColor:r="#000000",sectionColor:a="#2080ff",cellSize:o=.5,sectionSize:s=1,followCamera:g=!1,infiniteGrid:u=!1,fadeDistance:i=100,fadeStrength:c=1,cellThickness:d=.5,sectionThickness:p=1,side:f=oe,...m},h)=>{re({GridMaterial:Ee});const v={cellSize:o,sectionSize:s,cellColor:r,sectionColor:a,cellThickness:d,sectionThickness:p},l={fadeDistance:i,fadeStrength:c,infiniteGrid:u,followCamera:g};return e.createElement("mesh",x({ref:h,frustumCulled:!1},m),e.createElement("gridMaterial",x({transparent:!0,"extensions-derivatives":!0,side:f},v,l)),e.createElement("planeGeometry",{args:t}))});function ze(t){const r=ae();return E.jsx("div",{style:{backgroundColor:"#303035"},children:E.jsxs(ie,{shadows:!0,className:"gl-canvas",gl:{preserveDrawingBuffer:t.preserveDrawingBuffer??!1},onDoubleClick:()=>{r.setActiveNode(null)},camera:{far:1e4,position:[4,3,12]},style:{height:"100vh",...t.style?t.style:{}},raycaster:{params:{Line:{threshold:.15}}},children:[E.jsx("directionalLight",{castShadow:!0,position:[2.5,5,5],intensity:1.5,"shadow-mapSize":[1024,1024],children:E.jsx("orthographicCamera",{attach:"shadow-camera",args:[-5,5,5,-5,1,50]})}),L.Children.toArray(t.children)]})})}function Me(t){const r={cellSize:.5,cellThickness:.5,cellColor:"#6f6f6f",sectionSize:3,sectionThickness:1,sectionColor:"#9d4b4b",followCamera:!1,infiniteGrid:!0};return E.jsx(we,{position:[0,t.height??-.01,0],args:[10.5,10.5],...r})}function ke({}){return E.jsx(L.Suspense,{fallback:"",children:E.jsx(se,{preset:"forest"})})}function Re({}){return E.jsx(ce,{makeDefault:!0,target:[0,0,0],enableDamping:!1,maxPolarAngle:Math.PI/2})}function je(){return E.jsx(xe,{alignment:"bottom-right",margin:[80,80],children:E.jsx(Ce,{axisColors:["red","#34eb37","#347deb"],labelColor:"black"})})}export{je as S,ze as U,ke as a,Re as b,Me as c};
