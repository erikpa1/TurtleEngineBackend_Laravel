import{an as Mn,N as R,a0 as Rt,ak as tn,ao as Nn,ap as Pn,aq as Un,ar as Dn,as as Ln,at as kn,au as Fn,av as zn,aw as Bn,X as xn,ax as Zn,_ as Hn,ay as Gn,az as Yn,ag as He,ai as Yt,aA as Xt,aB as ze,aC as Nt,aD as Pt,aE as Ke,aF as qe,aG as nn,aa as xe,ac as $e,aH as Ve,a9 as It,aI as Xn,aJ as jn,aK as Wn,L as Pe,$ as rn,aL as Kn,I as qn,aM as Vn,aN as $n,aO as Qn,ad as Jn,aP as er,ae as tr}from"./index-bbd1ebcb.js";function Ft(a,o,l){var n,h,d,I,p;o==null&&(o=100);function v(){var A=Date.now()-I;A<o&&A>=0?n=setTimeout(v,o-A):(n=null,l||(p=a.apply(d,h),d=h=null))}var D=function(){d=this,h=arguments,I=Date.now();var A=l&&!n;return n||(n=setTimeout(v,o)),A&&(p=a.apply(d,h),d=h=null),p};return D.clear=function(){n&&(clearTimeout(n),n=null)},D.flush=function(){n&&(p=a.apply(d,h),d=h=null,clearTimeout(n),n=null)},D}Ft.debounce=Ft;var nr=Ft;const jt=Mn(nr);function rr(a){let{debounce:o,scroll:l,polyfill:n,offsetSize:h}=a===void 0?{debounce:0,scroll:!1,offsetSize:!1}:a;const d=n||(typeof window>"u"?class{}:window.ResizeObserver);if(!d)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[I,p]=R.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),v=R.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:I}),D=o?typeof o=="number"?o:o.scroll:null,A=o?typeof o=="number"?o:o.resize:null,F=R.useRef(!1);R.useEffect(()=>(F.current=!0,()=>void(F.current=!1)));const[K,j,J]=R.useMemo(()=>{const B=()=>{if(!v.current.element)return;const{left:T,top:k,width:P,height:C,bottom:Z,right:_,x:O,y:Y}=v.current.element.getBoundingClientRect(),U={left:T,top:k,width:P,height:C,bottom:Z,right:_,x:O,y:Y};v.current.element instanceof HTMLElement&&h&&(U.height=v.current.element.offsetHeight,U.width=v.current.element.offsetWidth),Object.freeze(U),F.current&&!sr(v.current.lastBounds,U)&&p(v.current.lastBounds=U)};return[B,A?jt(B,A):B,D?jt(B,D):B]},[p,h,D,A]);function $(){v.current.scrollContainers&&(v.current.scrollContainers.forEach(B=>B.removeEventListener("scroll",J,!0)),v.current.scrollContainers=null),v.current.resizeObserver&&(v.current.resizeObserver.disconnect(),v.current.resizeObserver=null)}function G(){v.current.element&&(v.current.resizeObserver=new d(J),v.current.resizeObserver.observe(v.current.element),l&&v.current.scrollContainers&&v.current.scrollContainers.forEach(B=>B.addEventListener("scroll",J,{capture:!0,passive:!0})))}const Q=B=>{!B||B===v.current.element||($(),v.current.element=B,v.current.scrollContainers=an(B),G())};return or(J,!!l),ar(j),R.useEffect(()=>{$(),G()},[l,J,j]),R.useEffect(()=>$,[]),[Q,I,K]}function ar(a){R.useEffect(()=>{const o=a;return window.addEventListener("resize",o),()=>void window.removeEventListener("resize",o)},[a])}function or(a,o){R.useEffect(()=>{if(o){const l=a;return window.addEventListener("scroll",l,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",l,!0)}},[a,o])}function an(a){const o=[];if(!a||a===document.body)return o;const{overflow:l,overflowX:n,overflowY:h}=window.getComputedStyle(a);return[l,n,h].some(d=>d==="auto"||d==="scroll")&&o.push(a),[...o,...an(a.parentElement)]}const ir=["x","y","top","bottom","left","right","width","height"],sr=(a,o)=>ir.every(l=>a[l]===o[l]);var lr=Object.defineProperty,cr=Object.defineProperties,ur=Object.getOwnPropertyDescriptors,Wt=Object.getOwnPropertySymbols,vr=Object.prototype.hasOwnProperty,hr=Object.prototype.propertyIsEnumerable,Kt=(a,o,l)=>o in a?lr(a,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[o]=l,qt=(a,o)=>{for(var l in o||(o={}))vr.call(o,l)&&Kt(a,l,o[l]);if(Wt)for(var l of Wt(o))hr.call(o,l)&&Kt(a,l,o[l]);return a},fr=(a,o)=>cr(a,ur(o));function on(a,o,l){if(!a)return;if(l(a)===!0)return a;let n=o?a.return:a.child;for(;n;){const h=on(n,o,l);if(h)return h;n=o?null:n.sibling}}function sn(a){try{return Object.defineProperties(a,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return a}}const xt=sn(R.createContext(null));class ln extends R.Component{render(){return R.createElement(xt.Provider,{value:this._reactInternals},this.props.children)}}const{ReactCurrentOwner:Vt,ReactCurrentDispatcher:$t}=R.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function pr(){const a=R.useContext(xt);if(a===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const o=R.useId();return R.useMemo(()=>{for(const n of[Vt==null?void 0:Vt.current,a,a==null?void 0:a.alternate]){if(!n)continue;const h=on(n,!1,d=>{let I=d.memoizedState;for(;I;){if(I.memoizedState===o)return!0;I=I.next}});if(h)return h}},[a,o])}function dr(){var a,o;const l=pr(),[n]=R.useState(()=>new Map);n.clear();let h=l;for(;h;){const d=(a=h.type)==null?void 0:a._context;d&&d!==xt&&!n.has(d)&&n.set(d,(o=$t==null?void 0:$t.current)==null?void 0:o.readContext(sn(d))),h=h.return}return n}function mr(){const a=dr();return R.useMemo(()=>Array.from(a.keys()).reduce((o,l)=>n=>R.createElement(o,null,R.createElement(l.Provider,fr(qt({},n),{value:a.get(l)}))),o=>R.createElement(ln,qt({},o))),[a])}const Ut={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Er(a){const{handlePointer:o}=Bn(a);return{priority:1,enabled:!0,compute(l,n,h){n.pointer.set(l.offsetX/n.size.width*2-1,-(l.offsetY/n.size.height)*2+1),n.raycaster.setFromCamera(n.pointer,n.camera)},connected:void 0,handlers:Object.keys(Ut).reduce((l,n)=>({...l,[n]:o(n)}),{}),update:()=>{var l;const{events:n,internal:h}=a.getState();(l=h.lastEvent)!=null&&l.current&&n.handlers&&n.handlers.onPointerMove(h.lastEvent.current)},connect:l=>{var n;const{set:h,events:d}=a.getState();d.disconnect==null||d.disconnect(),h(I=>({events:{...I.events,connected:l}})),Object.entries((n=d.handlers)!=null?n:[]).forEach(([I,p])=>{const[v,D]=Ut[I];l.addEventListener(v,p,{passive:D})})},disconnect:()=>{const{set:l,events:n}=a.getState();if(n.connected){var h;Object.entries((h=n.handlers)!=null?h:[]).forEach(([d,I])=>{if(n&&n.connected instanceof HTMLElement){const[p]=Ut[d];n.connected.removeEventListener(p,I)}}),l(d=>({events:{...d.events,connected:void 0}}))}}}}const gr=R.forwardRef(function({children:o,fallback:l,resize:n,style:h,gl:d,events:I=Er,eventSource:p,eventPrefix:v,shadows:D,linear:A,flat:F,legacy:K,orthographic:j,frameloop:J,dpr:$,performance:G,raycaster:Q,camera:B,onPointerMissed:T,onCreated:k,...P},C){R.useMemo(()=>tn(zn),[]);const Z=mr(),[_,O]=rr({scroll:!0,debounce:{scroll:50,resize:0},...n}),Y=R.useRef(null),U=R.useRef(null);R.useImperativeHandle(C,()=>Y.current);const ne=Nn(T),[_e,pe]=R.useState(!1),[Ee,de]=R.useState(!1);if(_e)throw _e;if(Ee)throw Ee;const ce=R.useRef(null);Pn(()=>{const Se=Y.current;O.width>0&&O.height>0&&Se&&(ce.current||(ce.current=Un(Se)),ce.current.configure({gl:d,events:I,shadows:D,linear:A,flat:F,legacy:K,orthographic:j,frameloop:J,dpr:$,performance:G,raycaster:Q,camera:B,size:O,onPointerMissed:(...se)=>ne.current==null?void 0:ne.current(...se),onCreated:se=>{se.events.connect==null||se.events.connect(p?Dn(p)?p.current:p:U.current),v&&se.setEvents({compute:(Ce,ue)=>{const De=Ce[v+"X"],Le=Ce[v+"Y"];ue.pointer.set(De/ue.size.width*2-1,-(Le/ue.size.height)*2+1),ue.raycaster.setFromCamera(ue.pointer,ue.camera)}}),k==null||k(se)}}),ce.current.render(R.createElement(Z,null,R.createElement(Ln,{set:de},R.createElement(R.Suspense,{fallback:R.createElement(kn,{set:pe})},o)))))}),R.useEffect(()=>{const Se=Y.current;if(Se)return()=>Fn(Se)},[]);const ge=p?"none":"auto";return R.createElement("div",Rt({ref:U,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:ge,...h}},P),R.createElement("div",{ref:_,style:{width:"100%",height:"100%"}},R.createElement("canvas",{ref:Y,style:{display:"block"}},l)))}),jr=R.forwardRef(function(o,l){return R.createElement(ln,null,R.createElement(gr,Rt({},o,{ref:l})))});var Ue=Uint8Array,Ye=Uint16Array,zt=Uint32Array,cn=new Ue([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),un=new Ue([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),br=new Ue([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),vn=function(a,o){for(var l=new Ye(31),n=0;n<31;++n)l[n]=o+=1<<a[n-1];for(var h=new zt(l[30]),n=1;n<30;++n)for(var d=l[n];d<l[n+1];++d)h[d]=d-l[n]<<5|n;return[l,h]},hn=vn(cn,2),fn=hn[0],_r=hn[1];fn[28]=258,_r[258]=28;var wr=vn(un,0),Sr=wr[0],Bt=new Ye(32768);for(var ie=0;ie<32768;++ie){var Ge=(ie&43690)>>>1|(ie&21845)<<1;Ge=(Ge&52428)>>>2|(Ge&13107)<<2,Ge=(Ge&61680)>>>4|(Ge&3855)<<4,Bt[ie]=((Ge&65280)>>>8|(Ge&255)<<8)>>>1}var ct=function(a,o,l){for(var n=a.length,h=0,d=new Ye(o);h<n;++h)++d[a[h]-1];var I=new Ye(o);for(h=0;h<o;++h)I[h]=I[h-1]+d[h-1]<<1;var p;if(l){p=new Ye(1<<o);var v=15-o;for(h=0;h<n;++h)if(a[h])for(var D=h<<4|a[h],A=o-a[h],F=I[a[h]-1]++<<A,K=F|(1<<A)-1;F<=K;++F)p[Bt[F]>>>v]=D}else for(p=new Ye(n),h=0;h<n;++h)a[h]&&(p[h]=Bt[I[a[h]-1]++]>>>15-a[h]);return p},ut=new Ue(288);for(var ie=0;ie<144;++ie)ut[ie]=8;for(var ie=144;ie<256;++ie)ut[ie]=9;for(var ie=256;ie<280;++ie)ut[ie]=7;for(var ie=280;ie<288;++ie)ut[ie]=8;var pn=new Ue(32);for(var ie=0;ie<32;++ie)pn[ie]=5;var yr=ct(ut,9,1),Ir=ct(pn,5,1),Dt=function(a){for(var o=a[0],l=1;l<a.length;++l)a[l]>o&&(o=a[l]);return o},ke=function(a,o,l){var n=o/8|0;return(a[n]|a[n+1]<<8)>>(o&7)&l},Lt=function(a,o){var l=o/8|0;return(a[l]|a[l+1]<<8|a[l+2]<<16)>>(o&7)},Rr=function(a){return(a/8|0)+(a&7&&1)},Tr=function(a,o,l){(o==null||o<0)&&(o=0),(l==null||l>a.length)&&(l=a.length);var n=new(a instanceof Ye?Ye:a instanceof zt?zt:Ue)(l-o);return n.set(a.subarray(o,l)),n},Cr=function(a,o,l){var n=a.length;if(!n||l&&!l.l&&n<5)return o||new Ue(0);var h=!o||l,d=!l||l.i;l||(l={}),o||(o=new Ue(n*3));var I=function(q){var Ae=o.length;if(q>Ae){var Oe=new Ue(Math.max(Ae*2,q));Oe.set(o),o=Oe}},p=l.f||0,v=l.p||0,D=l.b||0,A=l.l,F=l.d,K=l.m,j=l.n,J=n*8;do{if(!A){l.f=p=ke(a,v,1);var $=ke(a,v+1,3);if(v+=3,$)if($==1)A=yr,F=Ir,K=9,j=5;else if($==2){var T=ke(a,v,31)+257,k=ke(a,v+10,15)+4,P=T+ke(a,v+5,31)+1;v+=14;for(var C=new Ue(P),Z=new Ue(19),_=0;_<k;++_)Z[br[_]]=ke(a,v+_*3,7);v+=k*3;for(var O=Dt(Z),Y=(1<<O)-1,U=ct(Z,O,1),_=0;_<P;){var ne=U[ke(a,v,Y)];v+=ne&15;var G=ne>>>4;if(G<16)C[_++]=G;else{var _e=0,pe=0;for(G==16?(pe=3+ke(a,v,3),v+=2,_e=C[_-1]):G==17?(pe=3+ke(a,v,7),v+=3):G==18&&(pe=11+ke(a,v,127),v+=7);pe--;)C[_++]=_e}}var Ee=C.subarray(0,T),de=C.subarray(T);K=Dt(Ee),j=Dt(de),A=ct(Ee,K,1),F=ct(de,j,1)}else throw"invalid block type";else{var G=Rr(v)+4,Q=a[G-4]|a[G-3]<<8,B=G+Q;if(B>n){if(d)throw"unexpected EOF";break}h&&I(D+Q),o.set(a.subarray(G,B),D),l.b=D+=Q,l.p=v=B*8;continue}if(v>J){if(d)throw"unexpected EOF";break}}h&&I(D+131072);for(var ce=(1<<K)-1,ge=(1<<j)-1,Se=v;;Se=v){var _e=A[Lt(a,v)&ce],se=_e>>>4;if(v+=_e&15,v>J){if(d)throw"unexpected EOF";break}if(!_e)throw"invalid length/literal";if(se<256)o[D++]=se;else if(se==256){Se=v,A=null;break}else{var Ce=se-254;if(se>264){var _=se-257,ue=cn[_];Ce=ke(a,v,(1<<ue)-1)+fn[_],v+=ue}var De=F[Lt(a,v)&ge],Le=De>>>4;if(!De)throw"invalid distance";v+=De&15;var de=Sr[Le];if(Le>3){var ue=un[Le];de+=Lt(a,v)&(1<<ue)-1,v+=ue}if(v>J){if(d)throw"unexpected EOF";break}h&&I(D+131072);for(var Xe=D+Ce;D<Xe;D+=4)o[D]=o[D-de],o[D+1]=o[D+1-de],o[D+2]=o[D+2-de],o[D+3]=o[D+3-de];D=Xe}}l.l=A,l.p=Se,l.b=D,A&&(p=1,l.m=K,l.d=F,l.n=j)}while(!p);return D==o.length?o:Tr(o,0,D)},Ar=new Ue(0),Or=function(a){if((a[0]&15)!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(a[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function yt(a,o){return Cr((Or(a),a.subarray(2,-4)),o)}var Mr=typeof TextDecoder<"u"&&new TextDecoder,Nr=0;try{Mr.decode(Ar,{stream:!0}),Nr=1}catch{}const Pr=a=>a&&a.isCubeTexture;class Ur extends xn{constructor(o,l){var n,h;const d=Pr(o),p=((h=d?(n=o.image[0])==null?void 0:n.width:o.image.width)!=null?h:1024)/4,v=Math.floor(Math.log2(p)),D=Math.pow(2,v),A=3*Math.max(D,16*7),F=4*D,K=[d?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/A}`,`#define CUBEUV_TEXEL_HEIGHT ${1/F}`,`#define CUBEUV_MAX_MIP ${v}.0`],j=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,J=K.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <encodings_fragment>
        }
        `,$={map:{value:o},height:{value:(l==null?void 0:l.height)||15},radius:{value:(l==null?void 0:l.radius)||100}},G=new Zn(1,16),Q=new Hn({uniforms:$,fragmentShader:J,vertexShader:j,side:Gn});super(G,Q)}set radius(o){this.material.uniforms.radius.value=o}get radius(){return this.material.uniforms.radius.value}set height(o){this.material.uniforms.height.value=o}get height(){return this.material.uniforms.height.value}}var Dr=Object.defineProperty,Lr=(a,o,l)=>o in a?Dr(a,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[o]=l,z=(a,o,l)=>(Lr(a,typeof o!="symbol"?o+"":o,l),l);const Qt=(a,o)=>(a%o+o)%o;let kr=class extends Yn{constructor(o,l){super(),z(this,"object"),z(this,"domElement"),z(this,"enabled",!0),z(this,"target",new He),z(this,"minDistance",0),z(this,"maxDistance",1/0),z(this,"minZoom",0),z(this,"maxZoom",1/0),z(this,"minPolarAngle",0),z(this,"maxPolarAngle",Math.PI),z(this,"minAzimuthAngle",-1/0),z(this,"maxAzimuthAngle",1/0),z(this,"enableDamping",!1),z(this,"dampingFactor",.05),z(this,"enableZoom",!0),z(this,"zoomSpeed",1),z(this,"enableRotate",!0),z(this,"rotateSpeed",1),z(this,"enablePan",!0),z(this,"panSpeed",1),z(this,"screenSpacePanning",!0),z(this,"keyPanSpeed",7),z(this,"autoRotate",!1),z(this,"autoRotateSpeed",2),z(this,"reverseOrbit",!1),z(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),z(this,"mouseButtons",{LEFT:Ke.ROTATE,MIDDLE:Ke.DOLLY,RIGHT:Ke.PAN}),z(this,"touches",{ONE:qe.ROTATE,TWO:qe.DOLLY_PAN}),z(this,"target0"),z(this,"position0"),z(this,"zoom0"),z(this,"_domElementKeyEvents",null),z(this,"getPolarAngle"),z(this,"getAzimuthalAngle"),z(this,"setPolarAngle"),z(this,"setAzimuthalAngle"),z(this,"getDistance"),z(this,"listenToKeyEvents"),z(this,"saveState"),z(this,"reset"),z(this,"update"),z(this,"connect"),z(this,"dispose"),this.object=o,this.domElement=l,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>A.phi,this.getAzimuthalAngle=()=>A.theta,this.setPolarAngle=i=>{let w=Qt(i,2*Math.PI),M=A.phi;M<0&&(M+=2*Math.PI),w<0&&(w+=2*Math.PI);let W=Math.abs(w-M);2*Math.PI-W<W&&(w<M?w+=2*Math.PI:M+=2*Math.PI),F.phi=w-M,n.update()},this.setAzimuthalAngle=i=>{let w=Qt(i,2*Math.PI),M=A.theta;M<0&&(M+=2*Math.PI),w<0&&(w+=2*Math.PI);let W=Math.abs(w-M);2*Math.PI-W<W&&(w<M?w+=2*Math.PI:M+=2*Math.PI),F.theta=w-M,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=i=>{i.addEventListener("keydown",Et),this._domElementKeyEvents=i},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(h),n.update(),v=p.NONE},this.update=(()=>{const i=new He,w=new Yt().setFromUnitVectors(o.up,new He(0,1,0)),M=w.clone().invert(),W=new He,ve=new Yt,fe=2*Math.PI;return function(){const wt=n.object.position;i.copy(wt).sub(n.target),i.applyQuaternion(w),A.setFromVector3(i),n.autoRotate&&v===p.NONE&&ne(Y()),n.enableDamping?(A.theta+=F.theta*n.dampingFactor,A.phi+=F.phi*n.dampingFactor):(A.theta+=F.theta,A.phi+=F.phi);let y=n.minAzimuthAngle,Ie=n.maxAzimuthAngle;return isFinite(y)&&isFinite(Ie)&&(y<-Math.PI?y+=fe:y>Math.PI&&(y-=fe),Ie<-Math.PI?Ie+=fe:Ie>Math.PI&&(Ie-=fe),y<=Ie?A.theta=Math.max(y,Math.min(Ie,A.theta)):A.theta=A.theta>(y+Ie)/2?Math.max(y,A.theta):Math.min(Ie,A.theta)),A.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,A.phi)),A.makeSafe(),A.radius*=K,A.radius=Math.max(n.minDistance,Math.min(n.maxDistance,A.radius)),n.enableDamping===!0?n.target.addScaledVector(j,n.dampingFactor):n.target.add(j),i.setFromSpherical(A),i.applyQuaternion(M),wt.copy(n.target).add(i),n.object.lookAt(n.target),n.enableDamping===!0?(F.theta*=1-n.dampingFactor,F.phi*=1-n.dampingFactor,j.multiplyScalar(1-n.dampingFactor)):(F.set(0,0,0),j.set(0,0,0)),K=1,J||W.distanceToSquared(n.object.position)>D||8*(1-ve.dot(n.object.quaternion))>D?(n.dispatchEvent(h),W.copy(n.object.position),ve.copy(n.object.quaternion),J=!1,!0):!1}})(),this.connect=i=>{i===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),n.domElement=i,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",gt),n.domElement.addEventListener("pointerdown",dt),n.domElement.addEventListener("pointercancel",mt),n.domElement.addEventListener("wheel",nt)},this.dispose=()=>{var i,w,M,W,ve,fe;(i=n.domElement)==null||i.removeEventListener("contextmenu",gt),(w=n.domElement)==null||w.removeEventListener("pointerdown",dt),(M=n.domElement)==null||M.removeEventListener("pointercancel",mt),(W=n.domElement)==null||W.removeEventListener("wheel",nt),(ve=n.domElement)==null||ve.ownerDocument.removeEventListener("pointermove",et),(fe=n.domElement)==null||fe.ownerDocument.removeEventListener("pointerup",tt),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",Et)};const n=this,h={type:"change"},d={type:"start"},I={type:"end"},p={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let v=p.NONE;const D=1e-6,A=new Xt,F=new Xt;let K=1;const j=new He;let J=!1;const $=new ze,G=new ze,Q=new ze,B=new ze,T=new ze,k=new ze,P=new ze,C=new ze,Z=new ze,_=[],O={};function Y(){return 2*Math.PI/60/60*n.autoRotateSpeed}function U(){return Math.pow(.95,n.zoomSpeed)}function ne(i){n.reverseOrbit?F.theta+=i:F.theta-=i}function _e(i){n.reverseOrbit?F.phi+=i:F.phi-=i}const pe=(()=>{const i=new He;return function(M,W){i.setFromMatrixColumn(W,0),i.multiplyScalar(-M),j.add(i)}})(),Ee=(()=>{const i=new He;return function(M,W){n.screenSpacePanning===!0?i.setFromMatrixColumn(W,1):(i.setFromMatrixColumn(W,0),i.crossVectors(n.object.up,i)),i.multiplyScalar(M),j.add(i)}})(),de=(()=>{const i=new He;return function(M,W){const ve=n.domElement;if(ve&&n.object instanceof Nt&&n.object.isPerspectiveCamera){const fe=n.object.position;i.copy(fe).sub(n.target);let me=i.length();me*=Math.tan(n.object.fov/2*Math.PI/180),pe(2*M*me/ve.clientHeight,n.object.matrix),Ee(2*W*me/ve.clientHeight,n.object.matrix)}else ve&&n.object instanceof Pt&&n.object.isOrthographicCamera?(pe(M*(n.object.right-n.object.left)/n.object.zoom/ve.clientWidth,n.object.matrix),Ee(W*(n.object.top-n.object.bottom)/n.object.zoom/ve.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function ce(i){n.object instanceof Nt&&n.object.isPerspectiveCamera?K/=i:n.object instanceof Pt&&n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*i)),n.object.updateProjectionMatrix(),J=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function ge(i){n.object instanceof Nt&&n.object.isPerspectiveCamera?K*=i:n.object instanceof Pt&&n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/i)),n.object.updateProjectionMatrix(),J=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function Se(i){$.set(i.clientX,i.clientY)}function se(i){P.set(i.clientX,i.clientY)}function Ce(i){B.set(i.clientX,i.clientY)}function ue(i){G.set(i.clientX,i.clientY),Q.subVectors(G,$).multiplyScalar(n.rotateSpeed);const w=n.domElement;w&&(ne(2*Math.PI*Q.x/w.clientHeight),_e(2*Math.PI*Q.y/w.clientHeight)),$.copy(G),n.update()}function De(i){C.set(i.clientX,i.clientY),Z.subVectors(C,P),Z.y>0?ce(U()):Z.y<0&&ge(U()),P.copy(C),n.update()}function Le(i){T.set(i.clientX,i.clientY),k.subVectors(T,B).multiplyScalar(n.panSpeed),de(k.x,k.y),B.copy(T),n.update()}function Xe(i){i.deltaY<0?ge(U()):i.deltaY>0&&ce(U()),n.update()}function q(i){let w=!1;switch(i.code){case n.keys.UP:de(0,n.keyPanSpeed),w=!0;break;case n.keys.BOTTOM:de(0,-n.keyPanSpeed),w=!0;break;case n.keys.LEFT:de(n.keyPanSpeed,0),w=!0;break;case n.keys.RIGHT:de(-n.keyPanSpeed,0),w=!0;break}w&&(i.preventDefault(),n.update())}function Ae(){if(_.length==1)$.set(_[0].pageX,_[0].pageY);else{const i=.5*(_[0].pageX+_[1].pageX),w=.5*(_[0].pageY+_[1].pageY);$.set(i,w)}}function Oe(){if(_.length==1)B.set(_[0].pageX,_[0].pageY);else{const i=.5*(_[0].pageX+_[1].pageX),w=.5*(_[0].pageY+_[1].pageY);B.set(i,w)}}function vt(){const i=_[0].pageX-_[1].pageX,w=_[0].pageY-_[1].pageY,M=Math.sqrt(i*i+w*w);P.set(0,M)}function Tt(){n.enableZoom&&vt(),n.enablePan&&Oe()}function ht(){n.enableZoom&&vt(),n.enableRotate&&Ae()}function ft(i){if(_.length==1)G.set(i.pageX,i.pageY);else{const M=at(i),W=.5*(i.pageX+M.x),ve=.5*(i.pageY+M.y);G.set(W,ve)}Q.subVectors(G,$).multiplyScalar(n.rotateSpeed);const w=n.domElement;w&&(ne(2*Math.PI*Q.x/w.clientHeight),_e(2*Math.PI*Q.y/w.clientHeight)),$.copy(G)}function Qe(i){if(_.length==1)T.set(i.pageX,i.pageY);else{const w=at(i),M=.5*(i.pageX+w.x),W=.5*(i.pageY+w.y);T.set(M,W)}k.subVectors(T,B).multiplyScalar(n.panSpeed),de(k.x,k.y),B.copy(T)}function Je(i){const w=at(i),M=i.pageX-w.x,W=i.pageY-w.y,ve=Math.sqrt(M*M+W*W);C.set(0,ve),Z.set(0,Math.pow(C.y/P.y,n.zoomSpeed)),ce(Z.y),P.copy(C)}function pt(i){n.enableZoom&&Je(i),n.enablePan&&Qe(i)}function Ct(i){n.enableZoom&&Je(i),n.enableRotate&&ft(i)}function dt(i){var w,M;n.enabled!==!1&&(_.length===0&&((w=n.domElement)==null||w.ownerDocument.addEventListener("pointermove",et),(M=n.domElement)==null||M.ownerDocument.addEventListener("pointerup",tt)),bt(i),i.pointerType==="touch"?rt(i):At(i))}function et(i){n.enabled!==!1&&(i.pointerType==="touch"?Mt(i):Ot(i))}function tt(i){var w,M,W;je(i),_.length===0&&((w=n.domElement)==null||w.releasePointerCapture(i.pointerId),(M=n.domElement)==null||M.ownerDocument.removeEventListener("pointermove",et),(W=n.domElement)==null||W.ownerDocument.removeEventListener("pointerup",tt)),n.dispatchEvent(I),v=p.NONE}function mt(i){je(i)}function At(i){let w;switch(i.button){case 0:w=n.mouseButtons.LEFT;break;case 1:w=n.mouseButtons.MIDDLE;break;case 2:w=n.mouseButtons.RIGHT;break;default:w=-1}switch(w){case Ke.DOLLY:if(n.enableZoom===!1)return;se(i),v=p.DOLLY;break;case Ke.ROTATE:if(i.ctrlKey||i.metaKey||i.shiftKey){if(n.enablePan===!1)return;Ce(i),v=p.PAN}else{if(n.enableRotate===!1)return;Se(i),v=p.ROTATE}break;case Ke.PAN:if(i.ctrlKey||i.metaKey||i.shiftKey){if(n.enableRotate===!1)return;Se(i),v=p.ROTATE}else{if(n.enablePan===!1)return;Ce(i),v=p.PAN}break;default:v=p.NONE}v!==p.NONE&&n.dispatchEvent(d)}function Ot(i){if(n.enabled!==!1)switch(v){case p.ROTATE:if(n.enableRotate===!1)return;ue(i);break;case p.DOLLY:if(n.enableZoom===!1)return;De(i);break;case p.PAN:if(n.enablePan===!1)return;Le(i);break}}function nt(i){n.enabled===!1||n.enableZoom===!1||v!==p.NONE&&v!==p.ROTATE||(i.preventDefault(),n.dispatchEvent(d),Xe(i),n.dispatchEvent(I))}function Et(i){n.enabled===!1||n.enablePan===!1||q(i)}function rt(i){switch(_t(i),_.length){case 1:switch(n.touches.ONE){case qe.ROTATE:if(n.enableRotate===!1)return;Ae(),v=p.TOUCH_ROTATE;break;case qe.PAN:if(n.enablePan===!1)return;Oe(),v=p.TOUCH_PAN;break;default:v=p.NONE}break;case 2:switch(n.touches.TWO){case qe.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;Tt(),v=p.TOUCH_DOLLY_PAN;break;case qe.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;ht(),v=p.TOUCH_DOLLY_ROTATE;break;default:v=p.NONE}break;default:v=p.NONE}v!==p.NONE&&n.dispatchEvent(d)}function Mt(i){switch(_t(i),v){case p.TOUCH_ROTATE:if(n.enableRotate===!1)return;ft(i),n.update();break;case p.TOUCH_PAN:if(n.enablePan===!1)return;Qe(i),n.update();break;case p.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;pt(i),n.update();break;case p.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Ct(i),n.update();break;default:v=p.NONE}}function gt(i){n.enabled!==!1&&i.preventDefault()}function bt(i){_.push(i)}function je(i){delete O[i.pointerId];for(let w=0;w<_.length;w++)if(_[w].pointerId==i.pointerId){_.splice(w,1);return}}function _t(i){let w=O[i.pointerId];w===void 0&&(w=new ze,O[i.pointerId]=w),w.set(i.pageX,i.pageY)}function at(i){const w=i.pointerId===_[0].pointerId?_[1]:_[0];return O[w.pointerId]}l!==void 0&&this.connect(l),this.update()}};class Fr extends nn{constructor(o){super(o),this.type=xe}parse(o){const p=function(T,k){switch(T){case 1:console.error("THREE.RGBELoader Read Error: "+(k||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(k||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(k||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(k||""))}return-1},F=`
`,K=function(T,k,P){k=k||1024;let Z=T.pos,_=-1,O=0,Y="",U=String.fromCharCode.apply(null,new Uint16Array(T.subarray(Z,Z+128)));for(;0>(_=U.indexOf(F))&&O<k&&Z<T.byteLength;)Y+=U,O+=U.length,Z+=128,U+=String.fromCharCode.apply(null,new Uint16Array(T.subarray(Z,Z+128)));return-1<_?(P!==!1&&(T.pos+=O+_+1),Y+U.slice(0,_)):!1},j=function(T){const k=/^#\?(\S+)/,P=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,C=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,Z=/^\s*FORMAT=(\S+)\s*$/,_=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,O={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let Y,U;if(T.pos>=T.byteLength||!(Y=K(T)))return p(1,"no header found");if(!(U=Y.match(k)))return p(3,"bad initial token");for(O.valid|=1,O.programtype=U[1],O.string+=Y+`
`;Y=K(T),Y!==!1;){if(O.string+=Y+`
`,Y.charAt(0)==="#"){O.comments+=Y+`
`;continue}if((U=Y.match(P))&&(O.gamma=parseFloat(U[1])),(U=Y.match(C))&&(O.exposure=parseFloat(U[1])),(U=Y.match(Z))&&(O.valid|=2,O.format=U[1]),(U=Y.match(_))&&(O.valid|=4,O.height=parseInt(U[1],10),O.width=parseInt(U[2],10)),O.valid&2&&O.valid&4)break}return O.valid&2?O.valid&4?O:p(3,"missing image size specifier"):p(3,"missing format specifier")},J=function(T,k,P){const C=k;if(C<8||C>32767||T[0]!==2||T[1]!==2||T[2]&128)return new Uint8Array(T);if(C!==(T[2]<<8|T[3]))return p(3,"wrong scanline width");const Z=new Uint8Array(4*k*P);if(!Z.length)return p(4,"unable to allocate buffer space");let _=0,O=0;const Y=4*C,U=new Uint8Array(4),ne=new Uint8Array(Y);let _e=P;for(;_e>0&&O<T.byteLength;){if(O+4>T.byteLength)return p(1);if(U[0]=T[O++],U[1]=T[O++],U[2]=T[O++],U[3]=T[O++],U[0]!=2||U[1]!=2||(U[2]<<8|U[3])!=C)return p(3,"bad rgbe scanline format");let pe=0,Ee;for(;pe<Y&&O<T.byteLength;){Ee=T[O++];const ce=Ee>128;if(ce&&(Ee-=128),Ee===0||pe+Ee>Y)return p(3,"bad scanline data");if(ce){const ge=T[O++];for(let Se=0;Se<Ee;Se++)ne[pe++]=ge}else ne.set(T.subarray(O,O+Ee),pe),pe+=Ee,O+=Ee}const de=C;for(let ce=0;ce<de;ce++){let ge=0;Z[_]=ne[ce+ge],ge+=C,Z[_+1]=ne[ce+ge],ge+=C,Z[_+2]=ne[ce+ge],ge+=C,Z[_+3]=ne[ce+ge],_+=4}_e--}return Z},$=function(T,k,P,C){const Z=T[k+3],_=Math.pow(2,Z-128)/255;P[C+0]=T[k+0]*_,P[C+1]=T[k+1]*_,P[C+2]=T[k+2]*_,P[C+3]=1},G=function(T,k,P,C){const Z=T[k+3],_=Math.pow(2,Z-128)/255;P[C+0]=Ve.toHalfFloat(Math.min(T[k+0]*_,65504)),P[C+1]=Ve.toHalfFloat(Math.min(T[k+1]*_,65504)),P[C+2]=Ve.toHalfFloat(Math.min(T[k+2]*_,65504)),P[C+3]=Ve.toHalfFloat(1)},Q=new Uint8Array(o);Q.pos=0;const B=j(Q);if(B!==-1){const T=B.width,k=B.height,P=J(Q.subarray(Q.pos),T,k);if(P!==-1){let C,Z,_;switch(this.type){case $e:_=P.length/4;const O=new Float32Array(_*4);for(let U=0;U<_;U++)$(P,U*4,O,U*4);C=O,Z=$e;break;case xe:_=P.length/4;const Y=new Uint16Array(_*4);for(let U=0;U<_;U++)G(P,U*4,Y,U*4);C=Y,Z=xe;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:T,height:k,data:C,header:B.string,gamma:B.gamma,exposure:B.exposure,type:Z}}}return null}setDataType(o){return this.type=o,this}load(o,l,n,h){function d(I,p){switch(I.type){case $e:case xe:"colorSpace"in I?I.colorSpace="srgb-linear":I.encoding=3e3,I.minFilter=It,I.magFilter=It,I.generateMipmaps=!1,I.flipY=!0;break}l&&l(I,p)}return super.load(o,d,n,h)}}const lt="colorSpace"in new Xn;class Jt extends nn{constructor(o){super(o),this.type=xe}parse(o){const O=Math.pow(2.7182818,2.2);function Y(e,t){for(var r=0,s=0;s<65536;++s)(s==0||e[s>>3]&1<<(s&7))&&(t[r++]=s);for(var c=r-1;r<65536;)t[r++]=0;return c}function U(e){for(var t=0;t<16384;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}const ne={l:0,c:0,lc:0};function _e(e,t,r,s,c){for(;r<e;)t=t<<8|W(s,c),r+=8;r-=e,ne.l=t>>r&(1<<e)-1,ne.c=t,ne.lc=r}const pe=new Array(59);function Ee(e){for(var t=0;t<=58;++t)pe[t]=0;for(var t=0;t<65537;++t)pe[e[t]]+=1;for(var r=0,t=58;t>0;--t){var s=r+pe[t]>>1;pe[t]=r,r=s}for(var t=0;t<65537;++t){var c=e[t];c>0&&(e[t]=c|pe[c]++<<6)}}function de(e,t,r,s,c,u,m){for(var f=r,b=0,g=0;c<=u;c++){if(f.value-r.value>s)return!1;_e(6,b,g,e,f);var S=ne.l;if(b=ne.c,g=ne.lc,m[c]=S,S==63){if(f.value-r.value>s)throw"Something wrong with hufUnpackEncTable";_e(8,b,g,e,f);var E=ne.l+6;if(b=ne.c,g=ne.lc,c+E>u+1)throw"Something wrong with hufUnpackEncTable";for(;E--;)m[c++]=0;c--}else if(S>=59){var E=S-59+2;if(c+E>u+1)throw"Something wrong with hufUnpackEncTable";for(;E--;)m[c++]=0;c--}}Ee(m)}function ce(e){return e&63}function ge(e){return e>>6}function Se(e,t,r,s){for(;t<=r;t++){var c=ge(e[t]),u=ce(e[t]);if(c>>u)throw"Invalid table entry";if(u>14){var m=s[c>>u-14];if(m.len)throw"Invalid table entry";if(m.lit++,m.p){var f=m.p;m.p=new Array(m.lit);for(var b=0;b<m.lit-1;++b)m.p[b]=f[b]}else m.p=new Array(1);m.p[m.lit-1]=t}else if(u)for(var g=0,b=1<<14-u;b>0;b--){var m=s[(c<<14-u)+g];if(m.len||m.p)throw"Invalid table entry";m.len=u,m.lit=t,g++}}return!0}const se={c:0,lc:0};function Ce(e,t,r,s){e=e<<8|W(r,s),t+=8,se.c=e,se.lc=t}const ue={c:0,lc:0};function De(e,t,r,s,c,u,m,f,b,g){if(e==t){s<8&&(Ce(r,s,c,m),r=se.c,s=se.lc),s-=8;var S=r>>s,S=new Uint8Array([S])[0];if(b.value+S>g)return!1;for(var E=f[b.value-1];S-- >0;)f[b.value++]=E}else if(b.value<g)f[b.value++]=e;else return!1;ue.c=r,ue.lc=s}function Le(e){return e&65535}function Xe(e){var t=Le(e);return t>32767?t-65536:t}const q={a:0,b:0};function Ae(e,t){var r=Xe(e),s=Xe(t),c=s,u=r+(c&1)+(c>>1),m=u,f=u-c;q.a=m,q.b=f}function Oe(e,t){var r=Le(e),s=Le(t),c=r-(s>>1)&65535,u=s+c-32768&65535;q.a=u,q.b=c}function vt(e,t,r,s,c,u,m){for(var f=m<16384,b=r>c?c:r,g=1,S;g<=b;)g<<=1;for(g>>=1,S=g,g>>=1;g>=1;){for(var E=0,he=E+u*(c-S),N=u*g,L=u*S,x=s*g,H=s*S,ee,re,be,Re;E<=he;E+=L){for(var ae=E,Fe=E+s*(r-S);ae<=Fe;ae+=H){var oe=ae+x,we=ae+N,Be=we+x;f?(Ae(e[ae+t],e[we+t]),ee=q.a,be=q.b,Ae(e[oe+t],e[Be+t]),re=q.a,Re=q.b,Ae(ee,re),e[ae+t]=q.a,e[oe+t]=q.b,Ae(be,Re),e[we+t]=q.a,e[Be+t]=q.b):(Oe(e[ae+t],e[we+t]),ee=q.a,be=q.b,Oe(e[oe+t],e[Be+t]),re=q.a,Re=q.b,Oe(ee,re),e[ae+t]=q.a,e[oe+t]=q.b,Oe(be,Re),e[we+t]=q.a,e[Be+t]=q.b)}if(r&g){var we=ae+N;f?Ae(e[ae+t],e[we+t]):Oe(e[ae+t],e[we+t]),ee=q.a,e[we+t]=q.b,e[ae+t]=ee}}if(c&g)for(var ae=E,Fe=E+s*(r-S);ae<=Fe;ae+=H){var oe=ae+x;f?Ae(e[ae+t],e[oe+t]):Oe(e[ae+t],e[oe+t]),ee=q.a,e[oe+t]=q.b,e[ae+t]=ee}S=g,g>>=1}return E}function Tt(e,t,r,s,c,u,m,f,b,g){for(var S=0,E=0,he=f,N=Math.trunc(c.value+(u+7)/8);c.value<N;)for(Ce(S,E,r,c),S=se.c,E=se.lc;E>=14;){var L=S>>E-14&16383,x=t[L];if(x.len)E-=x.len,De(x.lit,m,S,E,r,s,c,b,g,he),S=ue.c,E=ue.lc;else{if(!x.p)throw"hufDecode issues";var H;for(H=0;H<x.lit;H++){for(var ee=ce(e[x.p[H]]);E<ee&&c.value<N;)Ce(S,E,r,c),S=se.c,E=se.lc;if(E>=ee&&ge(e[x.p[H]])==(S>>E-ee&(1<<ee)-1)){E-=ee,De(x.p[H],m,S,E,r,s,c,b,g,he),S=ue.c,E=ue.lc;break}}if(H==x.lit)throw"hufDecode issues"}}var re=8-u&7;for(S>>=re,E-=re;E>0;){var x=t[S<<14-E&16383];if(x.len)E-=x.len,De(x.lit,m,S,E,r,s,c,b,g,he),S=ue.c,E=ue.lc;else throw"hufDecode issues"}return!0}function ht(e,t,r,s,c,u){var m={value:0},f=r.value,b=M(t,r),g=M(t,r);r.value+=4;var S=M(t,r);if(r.value+=4,b<0||b>=65537||g<0||g>=65537)throw"Something wrong with HUF_ENCSIZE";var E=new Array(65537),he=new Array(16384);U(he);var N=s-(r.value-f);if(de(e,t,r,N,b,g,E),S>8*(s-(r.value-f)))throw"Something wrong with hufUncompress";Se(E,b,g,he),Tt(E,he,e,t,r,S,g,u,c,m)}function ft(e,t,r){for(var s=0;s<r;++s)t[s]=e[t[s]]}function Qe(e){for(var t=1;t<e.length;t++){var r=e[t-1]+e[t]-128;e[t]=r}}function Je(e,t){for(var r=0,s=Math.floor((e.length+1)/2),c=0,u=e.length-1;!(c>u||(t[c++]=e[r++],c>u));)t[c++]=e[s++]}function pt(e){for(var t=e.byteLength,r=new Array,s=0,c=new DataView(e);t>0;){var u=c.getInt8(s++);if(u<0){var m=-u;t-=m+1;for(var f=0;f<m;f++)r.push(c.getUint8(s++))}else{var m=u;t-=2;for(var b=c.getUint8(s++),f=0;f<m+1;f++)r.push(b)}}return r}function Ct(e,t,r,s,c,u){var oe=new DataView(u.buffer),m=r[e.idx[0]].width,f=r[e.idx[0]].height,b=3,g=Math.floor(m/8),S=Math.ceil(m/8),E=Math.ceil(f/8),he=m-(S-1)*8,N=f-(E-1)*8,L={value:0},x=new Array(b),H=new Array(b),ee=new Array(b),re=new Array(b),be=new Array(b);for(let te=0;te<b;++te)be[te]=t[e.idx[te]],x[te]=te<1?0:x[te-1]+S*E,H[te]=new Float32Array(64),ee[te]=new Uint16Array(64),re[te]=new Uint16Array(S*64);for(let te=0;te<E;++te){var Re=8;te==E-1&&(Re=N);var ae=8;for(let le=0;le<S;++le){le==S-1&&(ae=he);for(let V=0;V<b;++V)ee[V].fill(0),ee[V][0]=c[x[V]++],dt(L,s,ee[V]),et(ee[V],H[V]),tt(H[V]);mt(H);for(let V=0;V<b;++V)At(H[V],re[V],le*64)}let ye=0;for(let le=0;le<b;++le){const V=r[e.idx[le]].type;for(let Ne=8*te;Ne<8*te+Re;++Ne){ye=be[le][Ne];for(let We=0;We<g;++We){const Te=We*64+(Ne&7)*8;oe.setUint16(ye+0*2*V,re[le][Te+0],!0),oe.setUint16(ye+1*2*V,re[le][Te+1],!0),oe.setUint16(ye+2*2*V,re[le][Te+2],!0),oe.setUint16(ye+3*2*V,re[le][Te+3],!0),oe.setUint16(ye+4*2*V,re[le][Te+4],!0),oe.setUint16(ye+5*2*V,re[le][Te+5],!0),oe.setUint16(ye+6*2*V,re[le][Te+6],!0),oe.setUint16(ye+7*2*V,re[le][Te+7],!0),ye+=8*2*V}}if(g!=S)for(let Ne=8*te;Ne<8*te+Re;++Ne){const We=be[le][Ne]+8*g*2*V,Te=g*64+(Ne&7)*8;for(let Ze=0;Ze<ae;++Ze)oe.setUint16(We+Ze*2*V,re[le][Te+Ze],!0)}}}for(var Fe=new Uint16Array(m),oe=new DataView(u.buffer),we=0;we<b;++we){r[e.idx[we]].decoded=!0;var Be=r[e.idx[we]].type;if(r[we].type==2)for(var st=0;st<f;++st){const te=be[we][st];for(var Me=0;Me<m;++Me)Fe[Me]=oe.getUint16(te+Me*2*Be,!0);for(var Me=0;Me<m;++Me)oe.setFloat32(te+Me*2*Be,y(Fe[Me]),!0)}}}function dt(e,t,r){for(var s,c=1;c<64;)s=t[e.value],s==65280?c=64:s>>8==255?c+=s&255:(r[c]=s,c++),e.value++}function et(e,t){t[0]=y(e[0]),t[1]=y(e[1]),t[2]=y(e[5]),t[3]=y(e[6]),t[4]=y(e[14]),t[5]=y(e[15]),t[6]=y(e[27]),t[7]=y(e[28]),t[8]=y(e[2]),t[9]=y(e[4]),t[10]=y(e[7]),t[11]=y(e[13]),t[12]=y(e[16]),t[13]=y(e[26]),t[14]=y(e[29]),t[15]=y(e[42]),t[16]=y(e[3]),t[17]=y(e[8]),t[18]=y(e[12]),t[19]=y(e[17]),t[20]=y(e[25]),t[21]=y(e[30]),t[22]=y(e[41]),t[23]=y(e[43]),t[24]=y(e[9]),t[25]=y(e[11]),t[26]=y(e[18]),t[27]=y(e[24]),t[28]=y(e[31]),t[29]=y(e[40]),t[30]=y(e[44]),t[31]=y(e[53]),t[32]=y(e[10]),t[33]=y(e[19]),t[34]=y(e[23]),t[35]=y(e[32]),t[36]=y(e[39]),t[37]=y(e[45]),t[38]=y(e[52]),t[39]=y(e[54]),t[40]=y(e[20]),t[41]=y(e[22]),t[42]=y(e[33]),t[43]=y(e[38]),t[44]=y(e[46]),t[45]=y(e[51]),t[46]=y(e[55]),t[47]=y(e[60]),t[48]=y(e[21]),t[49]=y(e[34]),t[50]=y(e[37]),t[51]=y(e[47]),t[52]=y(e[50]),t[53]=y(e[56]),t[54]=y(e[59]),t[55]=y(e[61]),t[56]=y(e[35]),t[57]=y(e[36]),t[58]=y(e[48]),t[59]=y(e[49]),t[60]=y(e[57]),t[61]=y(e[58]),t[62]=y(e[62]),t[63]=y(e[63])}function tt(e){const t=.5*Math.cos(.7853975),r=.5*Math.cos(3.14159/16),s=.5*Math.cos(3.14159/8),c=.5*Math.cos(3*3.14159/16),u=.5*Math.cos(5*3.14159/16),m=.5*Math.cos(3*3.14159/8),f=.5*Math.cos(7*3.14159/16);for(var b=new Array(4),g=new Array(4),S=new Array(4),E=new Array(4),he=0;he<8;++he){var N=he*8;b[0]=s*e[N+2],b[1]=m*e[N+2],b[2]=s*e[N+6],b[3]=m*e[N+6],g[0]=r*e[N+1]+c*e[N+3]+u*e[N+5]+f*e[N+7],g[1]=c*e[N+1]-f*e[N+3]-r*e[N+5]-u*e[N+7],g[2]=u*e[N+1]-r*e[N+3]+f*e[N+5]+c*e[N+7],g[3]=f*e[N+1]-u*e[N+3]+c*e[N+5]-r*e[N+7],S[0]=t*(e[N+0]+e[N+4]),S[3]=t*(e[N+0]-e[N+4]),S[1]=b[0]+b[3],S[2]=b[1]-b[2],E[0]=S[0]+S[1],E[1]=S[3]+S[2],E[2]=S[3]-S[2],E[3]=S[0]-S[1],e[N+0]=E[0]+g[0],e[N+1]=E[1]+g[1],e[N+2]=E[2]+g[2],e[N+3]=E[3]+g[3],e[N+4]=E[3]-g[3],e[N+5]=E[2]-g[2],e[N+6]=E[1]-g[1],e[N+7]=E[0]-g[0]}for(var L=0;L<8;++L)b[0]=s*e[16+L],b[1]=m*e[16+L],b[2]=s*e[48+L],b[3]=m*e[48+L],g[0]=r*e[8+L]+c*e[24+L]+u*e[40+L]+f*e[56+L],g[1]=c*e[8+L]-f*e[24+L]-r*e[40+L]-u*e[56+L],g[2]=u*e[8+L]-r*e[24+L]+f*e[40+L]+c*e[56+L],g[3]=f*e[8+L]-u*e[24+L]+c*e[40+L]-r*e[56+L],S[0]=t*(e[L]+e[32+L]),S[3]=t*(e[L]-e[32+L]),S[1]=b[0]+b[3],S[2]=b[1]-b[2],E[0]=S[0]+S[1],E[1]=S[3]+S[2],E[2]=S[3]-S[2],E[3]=S[0]-S[1],e[0+L]=E[0]+g[0],e[8+L]=E[1]+g[1],e[16+L]=E[2]+g[2],e[24+L]=E[3]+g[3],e[32+L]=E[3]-g[3],e[40+L]=E[2]-g[2],e[48+L]=E[1]-g[1],e[56+L]=E[0]-g[0]}function mt(e){for(var t=0;t<64;++t){var r=e[0][t],s=e[1][t],c=e[2][t];e[0][t]=r+1.5747*c,e[1][t]=r-.1873*s-.4682*c,e[2][t]=r+1.8556*s}}function At(e,t,r){for(var s=0;s<64;++s)t[r+s]=Ve.toHalfFloat(Ot(e[s]))}function Ot(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(O,Math.abs(e)-1)}function nt(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function Et(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),r=new Uint8Array(pt(t)),s=new Uint8Array(r.length);return Qe(r),Je(r,s),new DataView(s.buffer)}function rt(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size),r=yt(t),s=new Uint8Array(r.length);return Qe(r),Je(r,s),new DataView(s.buffer)}function Mt(e){for(var t=e.viewer,r={value:e.offset.value},s=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),c=new Uint8Array(8192),u=0,m=new Array(e.channels),f=0;f<e.channels;f++)m[f]={},m[f].start=u,m[f].end=m[f].start,m[f].nx=e.width,m[f].ny=e.lines,m[f].size=e.type,u+=m[f].nx*m[f].ny*m[f].size;var b=Ie(t,r),g=Ie(t,r);if(g>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(b<=g)for(var f=0;f<g-b+1;f++)c[f+b]=ve(t,r);var S=new Uint16Array(65536),E=Y(c,S),he=M(t,r);ht(e.array,t,r,he,s,u);for(var f=0;f<e.channels;++f)for(var N=m[f],L=0;L<m[f].size;++L)vt(s,N.start+L,N.nx,N.size,N.ny,N.nx*N.size,E);ft(S,s,u);for(var x=0,H=new Uint8Array(s.buffer.byteLength),ee=0;ee<e.lines;ee++)for(var re=0;re<e.channels;re++){var N=m[re],be=N.nx*N.size,Re=new Uint8Array(s.buffer,N.end*2,be*2);H.set(Re,x),x+=be*2,N.end+=be}return new DataView(H.buffer)}function gt(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size),r=yt(t);const s=e.lines*e.channels*e.width,c=e.type==1?new Uint16Array(s):new Uint32Array(s);let u=0,m=0;const f=new Array(4);for(let b=0;b<e.lines;b++)for(let g=0;g<e.channels;g++){let S=0;switch(e.type){case 1:f[0]=u,f[1]=f[0]+e.width,u=f[1]+e.width;for(let E=0;E<e.width;++E){const he=r[f[0]++]<<8|r[f[1]++];S+=he,c[m]=S,m++}break;case 2:f[0]=u,f[1]=f[0]+e.width,f[2]=f[1]+e.width,u=f[2]+e.width;for(let E=0;E<e.width;++E){const he=r[f[0]++]<<24|r[f[1]++]<<16|r[f[2]++]<<8;S+=he,c[m]=S,m++}break}}return new DataView(c.buffer)}function bt(e){var t=e.viewer,r={value:e.offset.value},s=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),c={version:fe(t,r),unknownUncompressedSize:fe(t,r),unknownCompressedSize:fe(t,r),acCompressedSize:fe(t,r),dcCompressedSize:fe(t,r),rleCompressedSize:fe(t,r),rleUncompressedSize:fe(t,r),rleRawSize:fe(t,r),totalAcUncompressedCount:fe(t,r),totalDcUncompressedCount:fe(t,r),acCompression:fe(t,r)};if(c.version<2)throw"EXRLoader.parse: "+it.compression+" version "+c.version+" is unsupported";for(var u=new Array,m=Ie(t,r)-2;m>0;){var f=je(t.buffer,r),b=ve(t,r),g=b>>2&3,S=(b>>4)-1,E=new Int8Array([S])[0],he=ve(t,r);u.push({name:f,index:E,type:he,compression:g}),m-=f.length+3}for(var N=it.channels,L=new Array(e.channels),x=0;x<e.channels;++x){var H=L[x]={},ee=N[x];H.name=ee.name,H.compression=0,H.decoded=!1,H.type=ee.pixelType,H.pLinear=ee.pLinear,H.width=e.width,H.height=e.lines}for(var re={idx:new Array(3)},be=0;be<e.channels;++be)for(var H=L[be],x=0;x<u.length;++x){var Re=u[x];H.name==Re.name&&(H.compression=Re.compression,Re.index>=0&&(re.idx[Re.index]=be),H.offset=be)}if(c.acCompressedSize>0)switch(c.acCompression){case 0:var oe=new Uint16Array(c.totalAcUncompressedCount);ht(e.array,t,r,c.acCompressedSize,oe,c.totalAcUncompressedCount);break;case 1:var ae=e.array.slice(r.value,r.value+c.totalAcUncompressedCount),Fe=yt(ae),oe=new Uint16Array(Fe.buffer);r.value+=c.totalAcUncompressedCount;break}if(c.dcCompressedSize>0){var we={array:e.array,offset:r,size:c.dcCompressedSize},Be=new Uint16Array(rt(we).buffer);r.value+=c.dcCompressedSize}if(c.rleRawSize>0){var ae=e.array.slice(r.value,r.value+c.rleCompressedSize),Fe=yt(ae),st=pt(Fe.buffer);r.value+=c.rleCompressedSize}for(var Me=0,te=new Array(L.length),x=0;x<te.length;++x)te[x]=new Array;for(var ye=0;ye<e.lines;++ye)for(var le=0;le<L.length;++le)te[le].push(Me),Me+=L[le].width*e.type*2;Ct(re,te,L,oe,Be,s);for(var x=0;x<L.length;++x){var H=L[x];if(!H.decoded)switch(H.compression){case 2:for(var V=0,Ne=0,ye=0;ye<e.lines;++ye){for(var We=te[x][V],Te=0;Te<H.width;++Te){for(var Ze=0;Ze<2*H.type;++Ze)s[We++]=st[Ne+Ze*H.width*H.height];Ne++}V++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(s.buffer)}function je(e,t){for(var r=new Uint8Array(e),s=0;r[t.value+s]!=0;)s+=1;var c=new TextDecoder().decode(r.slice(t.value,t.value+s));return t.value=t.value+s+1,c}function _t(e,t,r){var s=new TextDecoder().decode(new Uint8Array(e).slice(t.value,t.value+r));return t.value=t.value+r,s}function at(e,t){var r=w(e,t),s=M(e,t);return[r,s]}function i(e,t){var r=M(e,t),s=M(e,t);return[r,s]}function w(e,t){var r=e.getInt32(t.value,!0);return t.value=t.value+4,r}function M(e,t){var r=e.getUint32(t.value,!0);return t.value=t.value+4,r}function W(e,t){var r=e[t.value];return t.value=t.value+1,r}function ve(e,t){var r=e.getUint8(t.value);return t.value=t.value+1,r}const fe=function(e,t){let r;return"getBigInt64"in DataView.prototype?r=Number(e.getBigInt64(t.value,!0)):r=e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,r};function me(e,t){var r=e.getFloat32(t.value,!0);return t.value+=4,r}function wt(e,t){return Ve.toHalfFloat(me(e,t))}function y(e){var t=(e&31744)>>10,r=e&1023;return(e>>15?-1:1)*(t?t===31?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):6103515625e-14*(r/1024))}function Ie(e,t){var r=e.getUint16(t.value,!0);return t.value+=2,r}function En(e,t){return y(Ie(e,t))}function gn(e,t,r,s){for(var c=r.value,u=[];r.value<c+s-1;){var m=je(t,r),f=w(e,r),b=ve(e,r);r.value+=3;var g=w(e,r),S=w(e,r);u.push({name:m,pixelType:f,pLinear:b,xSampling:g,ySampling:S})}return r.value+=1,u}function bn(e,t){var r=me(e,t),s=me(e,t),c=me(e,t),u=me(e,t),m=me(e,t),f=me(e,t),b=me(e,t),g=me(e,t);return{redX:r,redY:s,greenX:c,greenY:u,blueX:m,blueY:f,whiteX:b,whiteY:g}}function _n(e,t){var r=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],s=ve(e,t);return r[s]}function wn(e,t){var r=M(e,t),s=M(e,t),c=M(e,t),u=M(e,t);return{xMin:r,yMin:s,xMax:c,yMax:u}}function Sn(e,t){var r=["INCREASING_Y"],s=ve(e,t);return r[s]}function yn(e,t){var r=me(e,t),s=me(e,t);return[r,s]}function In(e,t){var r=me(e,t),s=me(e,t),c=me(e,t);return[r,s,c]}function Rn(e,t,r,s,c){if(s==="string"||s==="stringvector"||s==="iccProfile")return _t(t,r,c);if(s==="chlist")return gn(e,t,r,c);if(s==="chromaticities")return bn(e,r);if(s==="compression")return _n(e,r);if(s==="box2i")return wn(e,r);if(s==="lineOrder")return Sn(e,r);if(s==="float")return me(e,r);if(s==="v2f")return yn(e,r);if(s==="v3f")return In(e,r);if(s==="int")return w(e,r);if(s==="rational")return at(e,r);if(s==="timecode")return i(e,r);if(s==="preview")return r.value+=c,"skipped";r.value+=c}function Tn(e,t,r){const s={};if(e.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";s.version=e.getUint8(4);const c=e.getUint8(5);s.spec={singleTile:!!(c&2),longName:!!(c&4),deepFormat:!!(c&8),multiPart:!!(c&16)},r.value=8;for(var u=!0;u;){var m=je(t,r);if(m==0)u=!1;else{var f=je(t,r),b=M(e,r),g=Rn(e,t,r,f,b);g===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${f}'.`):s[m]=g}}if(c!=0)throw console.error("EXRHeader:",s),"THREE.EXRLoader: provided file is currently unsupported.";return s}function Cn(e,t,r,s,c){const u={size:0,viewer:t,array:r,offset:s,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[lt?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":u.lines=1,u.uncompress=nt;break;case"RLE_COMPRESSION":u.lines=1,u.uncompress=Et;break;case"ZIPS_COMPRESSION":u.lines=1,u.uncompress=rt;break;case"ZIP_COMPRESSION":u.lines=16,u.uncompress=rt;break;case"PIZ_COMPRESSION":u.lines=32,u.uncompress=Mt;break;case"PXR24_COMPRESSION":u.lines=16,u.uncompress=gt;break;case"DWAA_COMPRESSION":u.lines=32,u.uncompress=bt;break;case"DWAB_COMPRESSION":u.lines=256,u.uncompress=bt;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(u.scanlineBlockSize=u.lines,u.type==1)switch(c){case $e:u.getter=En,u.inputSize=2;break;case xe:u.getter=Ie,u.inputSize=2;break}else if(u.type==2)switch(c){case $e:u.getter=me,u.inputSize=4;break;case xe:u.getter=wt,u.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+u.type+" for "+e.compression+".";u.blockCount=(e.dataWindow.yMax+1)/u.scanlineBlockSize;for(var m=0;m<u.blockCount;m++)fe(t,s);u.outputChannels=u.channels==3?4:u.channels;const f=u.width*u.height*u.outputChannels;switch(c){case $e:u.byteArray=new Float32Array(f),u.channels<u.outputChannels&&u.byteArray.fill(1,0,f);break;case xe:u.byteArray=new Uint16Array(f),u.channels<u.outputChannels&&u.byteArray.fill(15360,0,f);break;default:console.error("THREE.EXRLoader: unsupported type: ",c);break}return u.bytesPerLine=u.width*u.inputSize*u.channels,u.outputChannels==4?u.format=jn:u.format=Wn,lt?u.colorSpace="srgb-linear":u.encoding=3e3,u}const St=new DataView(o),An=new Uint8Array(o),ot={value:0},it=Tn(St,o,ot),X=Cn(it,St,An,ot,this.type),Gt={value:0},On={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<X.height/X.scanlineBlockSize;e++){const t=M(St,ot);X.size=M(St,ot),X.lines=t+X.scanlineBlockSize>X.height?X.height-t:X.scanlineBlockSize;const s=X.size<X.lines*X.bytesPerLine?X.uncompress(X):nt(X);ot.value+=X.size;for(let c=0;c<X.scanlineBlockSize;c++){const u=c+e*X.scanlineBlockSize;if(u>=X.height)break;for(let m=0;m<X.channels;m++){const f=On[it.channels[m].name];for(let b=0;b<X.width;b++){Gt.value=(c*(X.channels*X.width)+m*X.width+b)*X.inputSize;const g=(X.height-1-u)*(X.width*X.outputChannels)+b*X.outputChannels+f;X.byteArray[g]=X.getter(s,Gt)}}}}return{header:it,width:X.width,height:X.height,data:X.byteArray,format:X.format,[lt?"colorSpace":"encoding"]:X[lt?"colorSpace":"encoding"],type:this.type}}setDataType(o){return this.type=o,this}load(o,l,n,h){function d(I,p){lt?I.colorSpace=p.colorSpace:I.encoding=p.encoding,I.minFilter=It,I.magFilter=It,I.generateMipmaps=!1,I.flipY=!1,l&&l(I,p)}return super.load(o,d,n,h)}}const Kr=R.forwardRef(({makeDefault:a,camera:o,regress:l,domElement:n,enableDamping:h=!0,keyEvents:d=!1,onChange:I,onStart:p,onEnd:v,...D},A)=>{const F=Pe(C=>C.invalidate),K=Pe(C=>C.camera),j=Pe(C=>C.gl),J=Pe(C=>C.events),$=Pe(C=>C.setEvents),G=Pe(C=>C.set),Q=Pe(C=>C.get),B=Pe(C=>C.performance),T=o||K,k=n||J.connected||j.domElement,P=R.useMemo(()=>new kr(T),[T]);return rn(()=>{P.enabled&&P.update()},-1),R.useEffect(()=>(d&&P.connect(d===!0?k:d),P.connect(k),()=>void P.dispose()),[d,k,l,P,F]),R.useEffect(()=>{const C=O=>{F(),l&&B.regress(),I&&I(O)},Z=O=>{p&&p(O)},_=O=>{v&&v(O)};return P.addEventListener("change",C),P.addEventListener("start",Z),P.addEventListener("end",_),()=>{P.removeEventListener("start",Z),P.removeEventListener("end",_),P.removeEventListener("change",C)}},[I,p,v,P,F,$]),R.useEffect(()=>{if(a){const C=Q().controls;return G({controls:P}),()=>G({controls:C})}},[a,P]),R.createElement("primitive",Rt({ref:A,object:P,enableDamping:h},D))}),kt={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},zr="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",Br=a=>typeof a=="object"&&typeof a.then=="function",en=a=>Array.isArray(a);function dn({files:a=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:o="",preset:l=void 0,encoding:n=void 0,extensions:h}={}){let d=null,I=!1,p;if(l){if(!(l in kt))throw new Error("Preset must be one of: "+Object.keys(kt).join(", "));a=kt[l],o=zr}if(Br(a))a=Kn(async j=>(await j).default,[a]),d=Jt;else{var v;I=en(a),p=!en(a)&&((v=a.split(".").pop())==null?void 0:v.toLowerCase()),d=I?Qn:p==="hdr"?Fr:p==="exr"?Jt:null}if(!d)throw new Error("useEnvironment: Unrecognized file extension: "+a);const D=qn(d,I?[a]:a,j=>{j.setPath==null||j.setPath(o),h&&h(j)}),A=I?D[0]:D;A.mapping=I?Vn:$n;const F=3001,K=3e3;return"colorSpace"in A?A.colorSpace=n??I?"srgb":"srgb-linear":A.encoding=n??I?F:K,A}const xr=a=>a.current&&a.current.isScene,Zr=a=>xr(a)?a.current:a;function Zt(a,o,l,n,h=0){const d=Zr(o||l),I=d.background,p=d.environment,v=d.backgroundBlurriness||0;return a!=="only"&&(d.environment=n),a&&(d.background=n),a&&d.backgroundBlurriness!==void 0&&(d.backgroundBlurriness=h),()=>{a!=="only"&&(d.environment=p),a&&(d.background=I),a&&d.backgroundBlurriness!==void 0&&(d.backgroundBlurriness=v)}}function Ht({scene:a,background:o=!1,blur:l,map:n}){const h=Pe(d=>d.scene);return R.useLayoutEffect(()=>{if(n)return Zt(o,a,h,n,l)},[h,a,n,o,l]),null}function mn({background:a=!1,scene:o,blur:l,...n}){const h=dn(n),d=Pe(I=>I.scene);return R.useLayoutEffect(()=>Zt(a,o,d,h,l),[h,a,o,d,l]),null}function Hr({children:a,near:o=1,far:l=1e3,resolution:n=256,frames:h=1,map:d,background:I=!1,blur:p,scene:v,files:D,path:A,preset:F=void 0,extensions:K}){const j=Pe(T=>T.gl),J=Pe(T=>T.scene),$=R.useRef(null),[G]=R.useState(()=>new Jn),Q=R.useMemo(()=>{const T=new er(n);return T.texture.type=xe,T},[n]);R.useLayoutEffect(()=>(h===1&&$.current.update(j,G),Zt(I,v,J,Q.texture,p)),[a,G,Q.texture,v,J,I,h,j]);let B=1;return rn(()=>{(h===1/0||B<h)&&($.current.update(j,G),B++)}),R.createElement(R.Fragment,null,tr(R.createElement(R.Fragment,null,a,R.createElement("cubeCamera",{ref:$,args:[o,l,Q]}),D||F?R.createElement(mn,{background:!0,files:D,preset:F,path:A,extensions:K}):d?R.createElement(Ht,{background:!0,map:d,extensions:K}):null),G))}function Gr(a){var o,l,n,h;const d=dn(a),I=a.map||d;R.useMemo(()=>tn({GroundProjectedEnvImpl:Ur}),[]);const p=R.useMemo(()=>[I],[I]),v=(o=a.ground)==null?void 0:o.height,D=(l=a.ground)==null?void 0:l.radius,A=(n=(h=a.ground)==null?void 0:h.scale)!==null&&n!==void 0?n:1e3;return R.createElement(R.Fragment,null,R.createElement(Ht,Rt({},a,{map:I})),R.createElement("groundProjectedEnvImpl",{args:p,scale:A,height:v,radius:D}))}function qr(a){return a.ground?R.createElement(Gr,a):a.map?R.createElement(Ht,a):a.children?R.createElement(Hr,a):R.createElement(mn,a)}export{jr as C,qr as E,Kr as O};
