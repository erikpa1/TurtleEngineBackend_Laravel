var Y=Object.defineProperty;var B=(e,s,a)=>s in e?Y(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a;var l=(e,s,a)=>(B(e,typeof s!="symbol"?s+"":s,a),a);import{u as b,c as S,j as t,b as i,F as h,M,a3 as P,R as u,d as A,aQ as O,aR as $,aS as W,k,h as _,A as x,E as N,e as F,aT as Z,a as V,O as H,S as J,aU as Q,r as q}from"./index-bbd1ebcb.js";import{b as z}from"./assets_hooks-1bb9fe8a.js";import{I as U,C as K}from"./CreateAssetWithFileContent-d3f9b504.js";import{I as E}from"./ImagesApi-25c337aa.js";const w={EDIT:"edit",SELECT:"select"};function X({asset:e,mode:s,onRefresh:a,onSelect:n}){const[r]=b(),o=S(),p=z(),f=()=>{p(e)},c=()=>{o.lock(),P.DeleteAssetWithUid(e).then(()=>{a&&a(),o.unlock()})},j=()=>{M.showYesNoModal({lang:`${r("sure.remove.asset")}: ${e.name} (${e.uid})`,onYes:c})};return t.jsxs(i.Card,{sx:{maxWidth:345},children:[t.jsx(i.CardMedia,{sx:{height:140},image:h.ConvertFilePath(e.GetPreviewPath()),title:e.name,style:{cursor:"pointer"},onClick:f}),t.jsxs(i.CardContent,{children:[e.subtype!==""&&t.jsxs(i.Typography,{variant:"body2",color:"text.secondary",children:[r("type"),": ",t.jsx("b",{children:e.subtype})]}),t.jsx(i.Typography,{gutterBottom:!0,variant:"h5",component:"div",children:e.name}),t.jsx(i.Typography,{variant:"body2",color:"text.secondary",style:{minHeight:"50px",maxHeight:"50px"},children:e.description})]}),t.jsxs(i.CardActions,{children:[s===w.EDIT&&t.jsxs(t.Fragment,{children:[t.jsx(i.Button,{onClick:f,label:"open"}),t.jsx(i.Button,{onClick:f,label:"edit"}),t.jsx(i.Button,{onClick:j,label:"delete",color:"error"})]}),s===w.SELECT&&t.jsx(t.Fragment,{children:t.jsx(i.Button,{onClick:()=>{n&&n(e)},label:"select"})})]})]})}class ee{constructor(){l(this,"name","");l(this,"uid","");l(this,"subtype","");l(this,"extension","");l(this,"description","");l(this,"assetType","");l(this,"project_uid","");l(this,"author","");l(this,"assetDefinition",null)}}class G{constructor(){l(this,"project_uid","");l(this,"folder","");l(this,"asset_type","");l(this,"asset_uid","");l(this,"path_from");l(this,"destination_name","");this.path_from=h.GetPlatformPath("Panoramas/PreviewPanorama.jpg"),this.destination_name=`Default.${h.GetFileExtension(this.path_from)}`}}class te{static async CreateAsset(s){return await P.CreateAsset(s)}static async CreateAssetThumbnail(s,a){const n=h.GetPathInProject(s.parent_project_uid,`Assets/${s.uid}/Preview.png`);await E.GeneratePreviewDesktop(a.path_from,n,256)}}class se{static async CreatePanoramaAsset(s,a){const n=await te.CreateAsset(s);a.asset_uid=n.uid;const r=await P.UpdateAssetFile(a),o=h.ReplaceFileNameAndExtension(r,"Preview.png");await E.GeneratePreviewDesktop(r,o,256),n.hasPreview=!0,await P.UploadAssetLight(n)}static async ReplacePanorama(s,a){alert("ReplacePanorama Unimplemented")}}function ae({asset:e}){const[s,a]=u.useState(e.name),n=r=>{const o=r.target.value;e.name=o,a(o)};return t.jsx(A,{value:s,onChange:n,label:"name"})}function ne({asset:e}){const[s,a]=u.useState(e.description),n=r=>{const o=r.target.value;e.description=o,a(o)};return t.jsx(A,{value:s,onChange:n,label:"description"})}function ie(e){const[s,a]=u.useState(e.asset.subtype);return t.jsx(i.TSelect,{onChange:n=>{const r=n.target.value;a(r),e.onSelected(r)},label:"type",value:s,items:e.options.map(n=>[n.key,n.lang])})}class oe{static async CreateSceneAsset(s,a){await P.CreateAssetFromLight(s);let n=null;s.subtype==="virtual"?n=new O:s.subtype==="panorama"?(n=new $,a&&(n.panorama_uid=a.uid)):n=new W,n.uid=s.uid,n.subtype=s.subtype,await P.UploadAssetData(s.parent_project_uid,s.uid,n.ToJson())}}function re(e){const s=k(),a=_(),[n,r]=u.useState(h.GetPlatformPath(x.Scene.DEFAULT_PREVIEW)),[o,p]=u.useState(null),[f,c]=u.useState(null),[j,T]=N.Cookie.useCookie("new-scene-type","virtual");u.useState(new G);const C=S(),D=async()=>{o&&(C.lock(),e.onClose&&e.onClose(),o.hasPreview=!0,await oe.CreateSceneAsset(o,f),await E.GeneratePreviewDesktop(n,h.GetPathInProject(a.project.uid,`Assets/${o.uid}/Preview.png`),256),C.unlock(),e.onRefresh&&e.onRefresh())};function d(){const m=t.jsx(i.Offcanvas,{closeEnabled:!0,onClose:s.popElement,width:"1000px",header:t.jsx(i.OffcanvasTitle,{children:"select"}),children:t.jsx(de,{md:4,assetDefinition:x.Panorama,parentProjectUid:a.project.uid,mode:y.SELECT,onSelect:g=>{c(g),s.popElement()}})});s.pushElement(m)}return u.useEffect(()=>{const m=new Z;m.type=x.Scene.TYPE,m.subtype=j,m.assetDefinition=x.Scene,m.parent_project_uid=a.project.uid,p(m)},[]),o?t.jsxs(t.Fragment,{children:[t.jsx(ae,{asset:o}),t.jsx(ne,{asset:o}),t.jsx(ie,{asset:o,options:x.Scene.SUBTYPES,onSelected:m=>{T(m)}}),t.jsxs(i.Switch,{condition:j,children:[t.jsx(i.Case,{value:"panorama",children:t.jsxs(i.Card,{children:[t.jsx(i.CardMedia,{sx:{height:140},image:h.ConvertFilePath(f?f.GetPreviewPath():"")}),t.jsx(i.CardActions,{children:t.jsx(i.Button,{onClick:d,label:"select"})})]})}),t.jsx(i.Default,{children:t.jsx(U,{image:n,imagePickedDesktop:m=>{r(m)},imagePickedWeb:()=>{alert("Unimplemented")}})})]}),t.jsx(i.Stack,{children:t.jsx(F,{variant:"outlined",onClick:D,label:"create.asset"})})]}):t.jsx(t.Fragment,{})}function ce(e){const[s]=i.T();let a=null;return e.assetDefinition.TYPE===x.Scene.TYPE?a=t.jsx(re,{...e}):a=t.jsx(le,{...e}),t.jsx(V,{onClose:e.onClose,closeEnabled:!0,header:t.jsxs(H.Title,{children:[s("create"),": ",t.jsx("b",{style:{textTransform:"uppercase"},children:s(e.assetDefinition.TYPE)})]}),children:t.jsx(i.Box,{children:t.jsx(J,{spacing:2,children:a})})})}function le(e){b();const s=e.assetDefinition,a=s.TYPE,n=S(),r=_(),o=r.project.uid,[p,f]=u.useState(h.GetPlatformPath(e.assetDefinition.DEFAULT_PREVIEW)),[c]=u.useState(new ee),[j]=u.useState(new G),T=async()=>{if(n.lock(),e.onClose&&e.onClose(),a===x.Panorama.TYPE)await se.CreatePanoramaAsset(c,j);else{const d=await P.CreateAsset(c),m=h.GetPathInProject(o,`Assets/${d.uid}/Preview.png`),g=e.assetDefinition.DEFAULT_DATA();g.uid=d.uid,await P.UploadAssetData(o,d.uid,g.ToJson()),e.assetDefinition.DEFAULT_FILES.length>0&&e.assetDefinition.DEFAULT_FILES.map(v=>{const L=h.GetPlatformPath(v[0]),I=`Assets/${d.uid}/${v[1]}`,R=h.GetPathInProject(o,I);P.CopyAssetFileDesktop(L,R)}),d.hasPreview=!0,await P.UploadAssetLight(d),await E.GeneratePreviewDesktop(p,m,256)}n.unlock(),e.onRefresh&&e.onRefresh()},C=d=>{c.name=d.target.value},D=d=>{c.description=d.target.value};return u.useEffect(()=>{c.assetDefinition=e.assetDefinition,c.assetType=e.assetDefinition.TYPE,c.project_uid=r.project.uid,j.project_uid=o,j.asset_type=a,j.path_from=h.GetPlatformPath(s.DEFAULT_PREVIEW)},[]),t.jsxs(t.Fragment,{children:[t.jsx(A,{onChange:C,label:"name"}),t.jsx(A,{onChange:D,label:"description",multiline:!0}),t.jsx(A,{label:"author",disabled:!0}),t.jsx(U,{image:p,imagePickedDesktop:d=>{f(d)},imagePickedWeb:()=>{alert("Unimplemented")}}),e.assetDefinition.TYPE===x.Panorama.TYPE&&t.jsx(K,{assetDefinition:s,uploadFileParams:j}),t.jsx(i.Stack,{children:t.jsx(F,{variant:"outlined",onClick:T,label:"create.asset"})})]})}const y={EDIT:"edit",SELECT:"select"};function de(e){const s=e.md??4,a=e.mode??y.EDIT,n=k(),[r,o]=u.useState(new Array),p=()=>{P.GetAllAssetsOfType(e.parentProjectUid,e.assetDefinition.TYPE).then(c=>{o(c)})},f=()=>{n.pushElement(t.jsx(ce,{assetDefinition:e.assetDefinition,onRefresh:p,onClose:n.popElement}))};return u.useEffect(p,[e.assetDefinition.TYPE]),t.jsxs("div",{className:"vstack gap-3",children:[t.jsx(i.MiddleSearchBar,{}),a===y.EDIT&&t.jsx(i.Stack,{children:t.jsx(i.Card,{style:{marginLeft:"auto",marginRight:"auto"},children:t.jsx(i.Button,{label:"asset.create",color:"success",onClick:f})})}),t.jsx(Q,{xs:1,md:s,className:`g-${s}`,children:r.map(c=>t.jsx(q,{children:t.jsx(X,{onRefresh:p,asset:c,mode:a,onSelect:e.onSelect})},c.uid))})]})}export{de as U,y as a};
