import{P as u,T as g,R as d,u as x,j as a,a as O,O as oe,b as m,c as T,F as y,S as L,d as h,e as W,M as ce,f as R,g as s,s as de,h as ue,i as me,k as N,C as he,l as pe,m as ge,n as k,o as ye,B as S,p as _e,E as we,q as be,U as Pe,r as je}from"./index-bbd1ebcb.js";import{I as F}from"./ImagesApi-25c337aa.js";import{I as fe}from"./CreateAssetWithFileContent-d3f9b504.js";class P{static async ActivateProject(t){if(u.IsDesktop()){const n=await g.ActivateProject(t);return await new Promise(i=>setTimeout(i,1e3)),n}return null}static async CreateProject(t){return u.IsDesktop()?await g.CreateProject(t):(alert("Create project is unimplemented for WEB"),"")}static async DeleteProject(t){return u.IsDesktop()?await g.DeleteProject(t):(alert("Create project is unimplemented for WEB"),!1)}static async GetAndActivateProject(t){return u.IsDesktop()?await g.GetAndActivateProject(t):(alert("Create project is unimplemented for WEB"),!1)}static async ListProjects(){return u.IsDesktop()?await g.ListProjects():(alert("ListProjects is not implemented for web"),[])}static async GetProjectLight(t){return u.IsDesktop()?await g.GetProjectLight(t):(alert("GetProjectLight is not implemented for web"),null)}static async UploadProjectLightData(t){return u.IsDesktop()?await g.UploadProjectLightData(t):(alert("GetProjectLight is not implemented for web"),!0)}}function ve(){const[e,t]=d.useState(!0),[n,i]=d.useState([]),r=()=>{t(!0),P.ListProjects().then(l=>{i(l),t(!1)})};return d.useEffect(r,[]),[n,e,r]}function xe(e){const[t,n]=d.useState(!0),[i,r]=d.useState(null);return d.useEffect(()=>{n(!0),P.GetProjectLight(e).then(l=>{r(l),n(!1)})},[e]),[i,t]}function We({onClose:e,onRefresh:t,uid:n}){const[i]=x(),[r,l]=xe(n);return a.jsx(O,{onClose:e,header:a.jsx(oe.Title,{children:i("project.edit")}),closeEnabled:!0,children:l||!r?a.jsx(m.MiddleSpinner,{}):a.jsx(Ce,{project:r,onClose:e,onRefresh:t})})}function Ce({project:e,onClose:t,onRefresh:n}){x();const i=T(),r=d.useRef(),[l,p]=d.useState(y.GetPathInProject(e.uid,"Preview.png")),[f,_]=d.useState(e.name),[w,b]=d.useState(e.author),[v,E]=d.useState(e.description),[o,J]=d.useState(e.lat_lon),X=c=>{_(c.target.value)},ee=c=>{E(c.target.value)},te=c=>{b(c.target.value)},ae=c=>{J(c.target.value)},se=()=>{i.lock(),t&&t();const c={uid:e.uid,name:f,author:w,description:v,lat_lon:o,project_type:e.project_type};P.UploadProjectLightData(c).then(()=>{i.unlock(),n&&n()})},ne=()=>{i.lock(),P.DeleteProject(e.uid).then(()=>{i.unlock(),n&&n(),t&&t()})},ie=()=>{ce.showYesNoModal({lang:"confirm.project.remove",onYes:ne})};function re(){u.IsDesktop()?u.OpenImageDialog().then(c=>{c!==""&&(p(c),F.GeneratePreviewDesktop(c,y.GetPathInProject(e.uid,"Preview.png"),512))}):r.current.click()}function le(){const c=r.current;console.log(c.files)}return a.jsx(a.Fragment,{children:a.jsx(m.Box,{style:{padding:"15px"},children:a.jsxs(L,{spacing:2,children:[a.jsxs(m.Card,{children:[a.jsx(m.CardMedia,{sx:{height:140},image:y.ConvertFilePath(l)}),a.jsxs(m.CardActions,{children:[a.jsx(m.Button,{label:"replace",onClick:re}),a.jsx("input",{ref:r,onChange:le,type:"file",hidden:!0})]})]}),a.jsx(h,{onChange:X,label:"project.name",value:f}),a.jsx(h,{label:"project.uid",value:e.uid,disabled:!0}),a.jsx(h,{onChange:ee,value:v,label:"project.description",multiline:!0}),a.jsx(h,{value:w,onChange:te,label:"project.author"}),a.jsx(h,{value:o,onChange:ae,label:"project.latlon"}),a.jsxs(L,{gap:1,direction:"row",children:[a.jsx(W,{onClick:se,label:"project.edit"}),a.jsx(W,{onClick:ie,label:"project.delete",color:"error"})]})]})})})}var Me={};R(Me,{TauriEvent:()=>H,emit:()=>Le,listen:()=>De,once:()=>Ee});async function U(e,t){return s({__tauriModule:"Event",message:{cmd:"unlisten",event:e,eventId:t}})}async function G(e,t,n){await s({__tauriModule:"Event",message:{cmd:"emit",event:e,windowLabel:t,payload:n}})}async function A(e,t,n){return s({__tauriModule:"Event",message:{cmd:"listen",event:e,windowLabel:t,handler:de(n)}}).then(i=>async()=>U(e,i))}async function B(e,t,n){return A(e,t,i=>{n(i),U(e,i.id).catch(()=>{})})}var H=(e=>(e.WINDOW_RESIZED="tauri://resize",e.WINDOW_MOVED="tauri://move",e.WINDOW_CLOSE_REQUESTED="tauri://close-requested",e.WINDOW_CREATED="tauri://window-created",e.WINDOW_DESTROYED="tauri://destroyed",e.WINDOW_FOCUS="tauri://focus",e.WINDOW_BLUR="tauri://blur",e.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",e.WINDOW_THEME_CHANGED="tauri://theme-changed",e.WINDOW_FILE_DROP="tauri://file-drop",e.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",e.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",e.MENU="tauri://menu",e.CHECK_UPDATE="tauri://update",e.UPDATE_AVAILABLE="tauri://update-available",e.INSTALL_UPDATE="tauri://update-install",e.STATUS_UPDATE="tauri://update-status",e.DOWNLOAD_PROGRESS="tauri://update-download-progress",e))(H||{});async function De(e,t){return A(e,null,t)}async function Ee(e,t){return B(e,null,t)}async function Le(e,t){return G(e,void 0,t)}var Te={};R(Te,{CloseRequestedEvent:()=>Q,LogicalPosition:()=>$,LogicalSize:()=>V,PhysicalPosition:()=>M,PhysicalSize:()=>C,UserAttentionType:()=>q,WebviewWindow:()=>j,WebviewWindowHandle:()=>Y,WindowManager:()=>K,appWindow:()=>D,availableMonitors:()=>Se,currentMonitor:()=>Ie,getAll:()=>Z,getCurrent:()=>Ae,primaryMonitor:()=>ke});var V=class{constructor(e,t){this.type="Logical",this.width=e,this.height=t}},C=class{constructor(e,t){this.type="Physical",this.width=e,this.height=t}toLogical(e){return new V(this.width/e,this.height/e)}},$=class{constructor(e,t){this.type="Logical",this.x=e,this.y=t}},M=class{constructor(e,t){this.type="Physical",this.x=e,this.y=t}toLogical(e){return new $(this.x/e,this.y/e)}},q=(e=>(e[e.Critical=1]="Critical",e[e.Informational=2]="Informational",e))(q||{});function Ae(){return new j(window.__TAURI_METADATA__.__currentWindow.label,{skip:!0})}function Z(){return window.__TAURI_METADATA__.__windows.map(e=>new j(e.label,{skip:!0}))}var z=["tauri://created","tauri://error"],Y=class{constructor(e){this.label=e,this.listeners=Object.create(null)}async listen(e,t){return this._handleTauriEvent(e,t)?Promise.resolve(()=>{let n=this.listeners[e];n.splice(n.indexOf(t),1)}):A(e,this.label,t)}async once(e,t){return this._handleTauriEvent(e,t)?Promise.resolve(()=>{let n=this.listeners[e];n.splice(n.indexOf(t),1)}):B(e,this.label,t)}async emit(e,t){if(z.includes(e)){for(let n of this.listeners[e]||[])n({event:e,id:-1,windowLabel:this.label,payload:t});return Promise.resolve()}return G(e,this.label,t)}_handleTauriEvent(e,t){return z.includes(e)?(e in this.listeners?this.listeners[e].push(t):this.listeners[e]=[t],!0):!1}},K=class extends Y{async scaleFactor(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"scaleFactor"}}}})}async innerPosition(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"innerPosition"}}}}).then(({x:e,y:t})=>new M(e,t))}async outerPosition(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"outerPosition"}}}}).then(({x:e,y:t})=>new M(e,t))}async innerSize(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"innerSize"}}}}).then(({width:e,height:t})=>new C(e,t))}async outerSize(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"outerSize"}}}}).then(({width:e,height:t})=>new C(e,t))}async isFullscreen(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isFullscreen"}}}})}async isMaximized(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isMaximized"}}}})}async isDecorated(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isDecorated"}}}})}async isResizable(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isResizable"}}}})}async isVisible(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"isVisible"}}}})}async theme(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"theme"}}}})}async center(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"center"}}}})}async requestUserAttention(e){let t=null;return e&&(e===1?t={type:"Critical"}:t={type:"Informational"}),s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"requestUserAttention",payload:t}}}})}async setResizable(e){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setResizable",payload:e}}}})}async setTitle(e){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setTitle",payload:e}}}})}async maximize(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"maximize"}}}})}async unmaximize(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"unmaximize"}}}})}async toggleMaximize(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"toggleMaximize"}}}})}async minimize(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"minimize"}}}})}async unminimize(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"unminimize"}}}})}async show(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"show"}}}})}async hide(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"hide"}}}})}async close(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"close"}}}})}async setDecorations(e){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setDecorations",payload:e}}}})}async setAlwaysOnTop(e){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setAlwaysOnTop",payload:e}}}})}async setSize(e){if(!e||e.type!=="Logical"&&e.type!=="Physical")throw new Error("the `size` argument must be either a LogicalSize or a PhysicalSize instance");return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setSize",payload:{type:e.type,data:{width:e.width,height:e.height}}}}}})}async setMinSize(e){if(e&&e.type!=="Logical"&&e.type!=="Physical")throw new Error("the `size` argument must be either a LogicalSize or a PhysicalSize instance");return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setMinSize",payload:e?{type:e.type,data:{width:e.width,height:e.height}}:null}}}})}async setMaxSize(e){if(e&&e.type!=="Logical"&&e.type!=="Physical")throw new Error("the `size` argument must be either a LogicalSize or a PhysicalSize instance");return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setMaxSize",payload:e?{type:e.type,data:{width:e.width,height:e.height}}:null}}}})}async setPosition(e){if(!e||e.type!=="Logical"&&e.type!=="Physical")throw new Error("the `position` argument must be either a LogicalPosition or a PhysicalPosition instance");return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setPosition",payload:{type:e.type,data:{x:e.x,y:e.y}}}}}})}async setFullscreen(e){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setFullscreen",payload:e}}}})}async setFocus(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setFocus"}}}})}async setIcon(e){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setIcon",payload:{icon:typeof e=="string"?e:Array.from(e)}}}}})}async setSkipTaskbar(e){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setSkipTaskbar",payload:e}}}})}async setCursorGrab(e){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setCursorGrab",payload:e}}}})}async setCursorVisible(e){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setCursorVisible",payload:e}}}})}async setCursorIcon(e){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setCursorIcon",payload:e}}}})}async setCursorPosition(e){if(!e||e.type!=="Logical"&&e.type!=="Physical")throw new Error("the `position` argument must be either a LogicalPosition or a PhysicalPosition instance");return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setCursorPosition",payload:{type:e.type,data:{x:e.x,y:e.y}}}}}})}async setIgnoreCursorEvents(e){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"setIgnoreCursorEvents",payload:e}}}})}async startDragging(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{label:this.label,cmd:{type:"startDragging"}}}})}async onResized(e){return this.listen("tauri://resize",e)}async onMoved(e){return this.listen("tauri://move",e)}async onCloseRequested(e){return this.listen("tauri://close-requested",t=>{let n=new Q(t);Promise.resolve(e(n)).then(()=>{if(!n.isPreventDefault())return this.close()})})}async onFocusChanged(e){let t=await this.listen("tauri://focus",i=>{e({...i,payload:!0})}),n=await this.listen("tauri://blur",i=>{e({...i,payload:!1})});return()=>{t(),n()}}async onScaleChanged(e){return this.listen("tauri://scale-change",e)}async onMenuClicked(e){return this.listen("tauri://menu",e)}async onFileDropEvent(e){let t=await this.listen("tauri://file-drop",r=>{e({...r,payload:{type:"drop",paths:r.payload}})}),n=await this.listen("tauri://file-drop-hover",r=>{e({...r,payload:{type:"hover",paths:r.payload}})}),i=await this.listen("tauri://file-drop-cancelled",r=>{e({...r,payload:{type:"cancel"}})});return()=>{t(),n(),i()}}async onThemeChanged(e){return this.listen("tauri://theme-changed",e)}},Q=class{constructor(e){this._preventDefault=!1,this.event=e.event,this.windowLabel=e.windowLabel,this.id=e.id}preventDefault(){this._preventDefault=!0}isPreventDefault(){return this._preventDefault}},j=class extends K{constructor(e,t={}){super(e),t!=null&&t.skip||s({__tauriModule:"Window",message:{cmd:"createWebview",data:{options:{label:e,...t}}}}).then(async()=>this.emit("tauri://created")).catch(async n=>this.emit("tauri://error",n))}static getByLabel(e){return Z().some(t=>t.label===e)?new j(e,{skip:!0}):null}},D;"__TAURI_METADATA__"in window?D=new j(window.__TAURI_METADATA__.__currentWindow.label,{skip:!0}):(console.warn(`Could not find "window.__TAURI_METADATA__". The "appWindow" value will reference the "main" window label.
Note that this is not an issue if running this frontend on a browser instead of a Tauri window.`),D=new j("main",{skip:!0}));function I(e){return e===null?null:{name:e.name,scaleFactor:e.scaleFactor,position:new M(e.position.x,e.position.y),size:new C(e.size.width,e.size.height)}}async function Ie(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{cmd:{type:"currentMonitor"}}}}).then(I)}async function ke(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{cmd:{type:"primaryMonitor"}}}}).then(I)}async function Se(){return s({__tauriModule:"Window",message:{cmd:"manage",data:{cmd:{type:"availableMonitors"}}}}).then(e=>e.map(I))}class ze{static async ChangeWindowTitle(t){D.setTitle(`Turtle Engine - ${t}`)}}function Oe({project:e,onRefresh:t}){const[n]=x(),i=T(),r=ue(),l=me(),[p,f]=d.useState({project:e}),_=N(),w=()=>{_.pushElement(a.jsx(We,{uid:e.uid,onClose:_.popElement,onRefresh:t}))},b=()=>{i.lock(),P.ActivateProject(e.uid).then(v=>{i.unlock(),r.setProject(e),l(_e.Assets(e.uid)),ze.ChangeWindowTitle(e.name)})};return a.jsxs(he,{sx:{maxWidth:345},children:[a.jsx(pe,{sx:{height:140},image:y.ConvertFilePath(y.GetPathInProject(e.uid,"Preview.png")),title:"green iguana",style:{cursor:"pointer"},onClick:b}),a.jsxs(ge,{children:[a.jsx(k,{gutterBottom:!0,variant:"h5",component:"div",children:p.project.name}),a.jsx(k,{variant:"body2",color:"text.secondary",style:{minHeight:"50px",maxHeight:"50px"},children:p.project.description}),a.jsxs(m.TextMicro,{children:["(",p.project.uid,")"]})]}),a.jsxs(ye,{children:[a.jsx(S,{size:"small",onClick:b,children:n("open")}),a.jsx(S,{onClick:w,size:"small",children:n("edit")})]})]})}function Re({onClose:e,onRefresh:t}){x(),d.useRef();const n=T(),[i,r]=d.useState(y.GetPlatformPath("Images/Previews/project-Preview.png")),[l]=d.useState({name:"",author:"",description:"",project_type:"360",lat_lon:""}),p=async()=>{n.lock(),e();const o=await P.CreateProject(l);await F.GeneratePreviewDesktop(i,y.GetPathInProject(o,"Preview.png"),512),n.unlock(),t&&t()},f=o=>{l.name=o.target.value},_=o=>{l.description=o.target.value},w=o=>{l.author=o.target.value},b=o=>{l.lat_lon=o.target.value};function v(o){o!==""&&r(o)}function E(o){}return a.jsxs(O,{onClose:e,children:[a.jsx(m.Box,{children:a.jsxs(L,{spacing:2,children:[a.jsx(fe,{image:i,imagePickedDesktop:v,imagePickedWeb:E}),a.jsx(h,{onChange:f,label:"project.name"}),a.jsx(h,{onChange:_,label:"project.description",multiline:!0}),a.jsx(h,{onChange:w,label:"project.author"}),a.jsx(h,{onChange:b,label:"project.latlon"})]})}),a.jsx(W,{onClick:p,label:"project.create"})]})}function Ge({}){x();const[e,t,n]=ve();we.Cookie.useCookie("projects-selection-tab-main","0");const i=N(),r=()=>{i.pushElement(a.jsx(Re,{onClose:i.popElement,onRefresh:n}))};return t?a.jsx(be,{}):a.jsx(a.Fragment,{children:a.jsxs("div",{className:"vstack gap-2",children:[a.jsx("div",{style:{marginLeft:"auto",marginRight:"auto"},children:a.jsx(Pe,{placeHolder:"search"})}),a.jsx("div",{className:"hstack gap-3",style:{marginTop:"25px"},children:a.jsx("div",{style:{marginLeft:"auto",marginRight:"auto"},children:a.jsx(W,{onClick:r,label:"project.create",variant:"outlined"})})}),a.jsx(m.Row,{xs:1,md:4,className:"g-4",children:e.map(l=>a.jsx(je,{children:a.jsx(Oe,{project:l,onRefresh:n})},l.uid))})]})})}export{Ge as default};
