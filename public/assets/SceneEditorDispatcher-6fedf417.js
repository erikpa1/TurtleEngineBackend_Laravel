var M=Object.defineProperty;var O=(n,s,i)=>s in n?M(n,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[s]=i;var p=(n,s,i)=>(O(n,typeof s!="symbol"?s+"":s,i),i);import{P as b,F as v,z as k,a4 as S,j as e,a5 as u,b as c,U as L,w as N,u as _,k as A,A as g,a6 as D,c as z,R as h}from"./index-bbd1ebcb.js";import{U as C,a as y,S as P,b as U,c as E}from"./SceneCameraRotationGizmo-f63fe5c1.js";import{H as a,A as f,O as I}from"./OpenAssetFolderButton-b71f53ab.js";import{U as F,a as R}from"./UniversalAssetList-8b9736f0.js";import{a as w,P as B}from"./PhotoDom-ce1696c5.js";import{a as H,u as V}from"./assets_hooks-1bb9fe8a.js";import{O as W}from"./Environment-bbcc9cfa.js";import"./CreateAssetWithFileContent-d3f9b504.js";import"./ImagesApi-25c337aa.js";class J{constructor(){p(this,"useAmbientLight");this.useAmbientLight=!0}}class Z{static async SaveSceneDefinition(s,i,t){if(b.IsDesktop()){const o=v.GetPathInProject(s,`Assets/${i}/Default.json`),l=JSON.stringify(t.ToJson());await k.WriteFileString(o,l)}return!0}static async GetSceneGraphicParams(s,i){return new J}}const j={};j[u.TRANSLATE]="/icons/Gizmo.Translate.svg";j[u.ROTATE]="/icons/Gizmo.Rotate.svg";j[u.SCALE]="/icons/Gizmo.Scale.svg";function $({}){const n=S();function s(){const i=n.gizmoType;i===u.TRANSLATE?n.setGizmoType(u.SCALE):i===u.SCALE?n.setGizmoType(u.ROTATE):n.setGizmoType(u.TRANSLATE)}return e.jsx(a,{lang:n.gizmoType,icon:j[n.gizmoType],onClick:s})}function q(n){const[s]=c.T();return e.jsx(c.Offcanvas,{width:"600px",closeEnabled:!0,onClose:n.onHide,header:e.jsx(c.OffcanvasTitle,{children:s("select.node")}),children:e.jsx(Q,{...n})})}const K=[{name:"physics",values:[["physics.plane","/icons/Alchemy.svg"],["physics.avatar","/icons/Alchemy.svg"],["physics.box","/icons/Alchemy.svg"],["physics.sphere","/icons/Alchemy.svg"],["physics.cylinder","/icons/Alchemy.svg"]]},{name:"Media",values:[["media.video","/icons/Alchemy.svg"],["media.document","/icons/Alchemy.svg"],["media.audio","/icons/Alchemy.svg"]]},{name:"Data",values:[["media.video","/icons/Alchemy.svg"],["media.document","/icons/Alchemy.svg"],["media.audio","/icons/Alchemy.svg"],["media.audio","/icons/Alchemy.svg"],["media.audio","/icons/Alchemy.svg"]]}];function Q(n){const[s]=c.T();return e.jsxs(c.Stack,{gap:3,children:[e.jsx("div",{style:{marginLeft:"auto",marginRight:"auto"},children:e.jsx(L,{})}),K.map((i,t)=>e.jsxs(c.Stack,{gap:3,children:[e.jsx("h2",{children:s(i.name)}),e.jsx(c.Stack,{direction:"horizontal",gap:3,children:i.values.map((o,l)=>e.jsx(a,{lang:o[0],icon:o[1]},l))})]},t))]})}function X(n){const{projectuid:s}=N();_();const i=A();function t(l){const m=e.jsx(c.Offcanvas,{closeEnabled:!0,onClose:i.popElement,width:"1000px",header:e.jsx(c.OffcanvasTitle,{children:"select"}),children:e.jsx(F,{md:4,assetDefinition:l,parentProjectUid:s,mode:R.SELECT,onSelect:x=>{n.sceneDefinition.AddAssetChildren(x),i.popElement(),n.onSceneDefinitionChanged()}})});i.pushElement(m)}function o(){const l=e.jsx(q,{onHide:i.popElement,onSelect:m=>{n.sceneDefinition.AddAssetChildren(m),i.popElement(),n.onSceneDefinitionChanged()}});i.pushElement(l)}return e.jsxs(f,{placement:"bottom",children:[e.jsx(a,{lang:"scene",icon:"/icons/Scene.svg",onClick:()=>t(g.Scene)}),e.jsx(a,{lang:"mesh",icon:"/icons/Create.Mesh.svg",onClick:()=>t(g.Mesh)}),e.jsx(a,{lang:"video",icon:"/icons/Create.Video.svg",onClick:()=>t(g.Video)}),e.jsx(a,{lang:"Pdf",icon:"/icons/Create.Pdf.svg"}),e.jsx(a,{lang:"other",icon:"/icons/Create.Other.svg",onClick:o})]})}function Y({onClose:n,node:s}){const[i]=c.T(),t=D.GetEditorContent(s.type);return e.jsx(c.Offcanvas,{header:e.jsx(c.OffcanvasTitle,{children:i("edit")}),closeEnabled:!0,onClose:n,children:e.jsx(t,{node:s})})}function T(n){return e.jsxs(e.Fragment,{children:[e.jsx(X,{...n}),e.jsx(ee,{...n}),e.jsx(ne,{...n}),e.jsx(se,{...n})]})}function ee(n){const s=z();function i(){s.lock(),Z.SaveSceneDefinition(n.asset.parent_project_uid,n.asset.uid,n.sceneDefinition).then(()=>{s.unlock(),console.log("Scene saved")})}return e.jsxs(f,{placement:"top",children:[e.jsx(a,{icon:"/icons/Save.svg",lang:"save",onClick:i}),e.jsx(ie,{})]})}function ne(n){return e.jsxs(f,{placement:"left",children:[e.jsx(I,{asset:n.asset}),e.jsx($,{}),e.jsx(a,{lang:"edit",icon:"/icons/Management.svg"}),e.jsx(a,{lang:"snapshot",icon:"/icons/Management.svg"})]})}function se(n){const s=A(),t=S().activeNode;function o(){t&&n.sceneDefinition.DeleteChildrenWithUid(t.uid)}function l(){s.pushElement(e.jsx(Y,{node:t,onClose:s.popElement}))}return e.jsx(f,{placement:"right",children:t&&e.jsxs(e.Fragment,{children:[e.jsx(a,{lang:"delete",icon:"/icons/Delete.svg",onClick:o}),e.jsx(a,{lang:"edit",onClick:l,icon:"/icons/Management.svg"})]})})}function ie({}){return e.jsx(a,{lang:"north",icon:"/icons/Compas.svg"})}function G(n){const[s,i]=h.useState();function t(){const o=new Array;n.sceneDefinition.root.children.forEach(m=>{const x=D.GetFiberHandler(m.type);o.push(e.jsx(x,{node:m},m.uid))}),i(o)}return h.useEffect(()=>{const o=n.sceneDefinition.root;o.onChildrenChanged=t,t()},[]),s||e.jsx(e.Fragment,{})}function te({}){return e.jsxs("group",{children:[e.jsx(d,{position:[0,0,0]}),e.jsx(d,{position:[0,1,0]}),e.jsx(d,{position:[1,0,0]}),e.jsx(d,{position:[1,1,0]}),e.jsx(d,{position:[0,0,1]}),e.jsx(d,{position:[0,1,1]}),e.jsx(d,{position:[1,0,1]}),e.jsx(d,{position:[1,1,1]}),e.jsx(r,{position:[.5,0,0],rotation:[0,0,0]}),e.jsx(r,{position:[.5,0,1],rotation:[0,0,0]}),e.jsx(r,{position:[.5,1,0],rotation:[0,0,0]}),e.jsx(r,{position:[.5,1,1],rotation:[0,0,0]}),e.jsx(r,{position:[1,0,.5],rotation:[0,Math.PI/2,0]}),e.jsx(r,{position:[0,0,.5],rotation:[0,Math.PI/2,0]}),e.jsx(r,{position:[1,1,.5],rotation:[0,Math.PI/2,0]}),e.jsx(r,{position:[0,1,.5],rotation:[0,Math.PI/2,0]}),e.jsx(r,{position:[1,.5,1],rotation:[0,0,Math.PI/2]}),e.jsx(r,{position:[0,.5,1],rotation:[0,0,Math.PI/2]}),e.jsx(r,{position:[1,.5,0],rotation:[0,0,Math.PI/2]}),e.jsx(r,{position:[0,.5,0],rotation:[0,0,Math.PI/2]})]})}function d({position:n}){return e.jsxs("mesh",{position:n,visible:!0,scale:[1,1,1],children:[e.jsx("boxGeometry",{args:[.05,.05,.05]}),e.jsx("meshBasicMaterial",{color:"#d06972"})]})}function r({position:n,rotation:s}){return e.jsxs("mesh",{position:n,visible:!0,scale:[1,1,1],rotation:s,children:[e.jsx("boxGeometry",{args:[1,.01,.01]}),e.jsx("meshBasicMaterial",{color:"#336abd"})]})}function oe({asset:n}){const[s,i]=h.useState([n.data]);return s?e.jsx(ae,{asset:n,sceneDefinition:s[0],onSceneDefinitionChanged:()=>{i([n.data])}}):e.jsx(e.Fragment,{})}function ae(n){return e.jsxs("div",{style:{position:"relative"},children:[e.jsxs(C,{children:[e.jsx(y,{}),e.jsx(P,{}),e.jsx(G,{sceneDefinition:n.sceneDefinition}),e.jsx(U,{}),e.jsx(E,{}),e.jsx(te,{})]}),e.jsx(T,{sceneDefinition:n.sceneDefinition,asset:n.asset,onSceneDefinitionChanged:n.onSceneDefinitionChanged})]})}function ce({asset:n}){const[s,i]=h.useState([n.data]);return s?e.jsx(re,{scene:n,sceneDefinition:s[0],onSceneDefinitionChanged:()=>{i([n.data])}}):e.jsx(e.Fragment,{})}function re(n){return e.jsxs("div",{style:{position:"relative"},children:[e.jsxs(C,{children:[e.jsx(y,{}),e.jsx(P,{}),e.jsx(G,{sceneDefinition:n.sceneDefinition}),e.jsx(le,{projectUid:n.scene.parent_project_uid,panoramaUid:n.sceneDefinition.panorama_uid}),e.jsx(W,{makeDefault:!0,target:[0,.15,0],enableDamping:!1,maxPolarAngle:Math.PI/2}),e.jsx(E,{height:-80})]}),e.jsx(T,{sceneDefinition:n.sceneDefinition,asset:n.scene,onSceneDefinitionChanged:n.onSceneDefinitionChanged})]})}function le({projectUid:n,panoramaUid:s}){return s&&s!==""?e.jsx(de,{projectUid:n,assetUid:s}):e.jsx(w,{path:v.GetPlatformPath("Panoramas/PreviewPanorama.jpg")})}function de({projectUid:n,assetUid:s}){const i=H(n,s);return i?e.jsx(B,{asset:i}):e.jsx(e.Fragment,{})}function Ae({}){const n=V();if(n){if(n.subtype==="panorama")return e.jsx(ce,{asset:n});if(n.subtype==="virtual")return e.jsx(oe,{asset:n})}else return e.jsx(c.MiddleSpinner,{})}export{Ae as default};
